
================================================================================
–ú–û–ù–û–õ–ò–¢–ù–´–ô –≠–ö–°–ü–û–†–¢ –ü–†–û–ï–ö–¢–ê: python_trading
================================================================================

üìÖ –î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: 2025-12-25 17:54:14
üìÅ –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞: /Users/vladimirbasov/Desktop/python_trading
üë§ –≠–∫—Å–ø–æ—Ä—Ç—ë—Ä: MonolithicProjectExporter v1.0

================================================================================
–ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
1. –§–∞–π–ª—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ —Å '======'
2. –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω—ã, –∫–ª—é—á–∏) –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ [SECRET_REMOVED]
3. –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã, —Ç–æ–ª—å–∫–æ –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
4. –í—Å–µ –ø—É—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
================================================================================



================================================================================
–§–ê–ô–õ: .env
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/.env
================================================================================

# Tinkoff Invest API
INVEST_TOKEN=[SECRET_REMOVED]

# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (sandbox –∏–ª–∏ real)
SANDBOX=false

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –¢–ì –±–æ—Ç–∞ - @trading_monitor_VB_bot
TELEGRAM_BOT_TOKEN=[SECRET_REMOVED]
TELEGRAM_CHAT_ID=162853294

# –ü—Ä–æ—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
DEFAULT_TICKER=DOMRF
DEFAULT_DEPTH=5
DEFAULT_INTERVAL=10
LOG_LEVEL=INFO
LOG_TO_FILE=true
MOEX_TIMEOUT=10
ENCRYPT_TOKENS=false


# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å account_id, –µ—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ
# ACCOUNT_ID=your_account_id



================================================================================
–§–ê–ô–õ: .gitignore
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/.gitignore
================================================================================

# Virtual environment
trading_env/

# Environment variables
.env
.env.local

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Logs
*.log
logs/

# IDE
.vscode/
.idea/
*.swp
*.swo

# Data files
*.csv
*.json
*.pkl
*.feather
*.parquet
data/

# Jupyter
.ipynb_checkpoints

# OS
.DS_Store
Thumbs.db


================================================================================
–§–ê–ô–õ: PROJECT_FULL_EXPORT_20251225_175414.txt
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/PROJECT_FULL_EXPORT_20251225_175414.txt
================================================================================



================================================================================
–§–ê–ô–õ: README.md
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/README.md
================================================================================


# Python Trading Bot

## –î–ò–°–ö–õ–ï–ô–ú–ï–† –ò –ü–†–ï–í–¨–Æ

**–ß—Ç–æ —ç—Ç–æ —Å–µ–π—á–∞—Å**
–°–∫—Ä–∏–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ –æ–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ –ø–æ–ª—É—á–∞—Ç—å —Å—Ç–∞–∫–∞–Ω –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏. –ù–µ –∏–º–µ–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**

- –ü–µ—Ä–≤–∞—è –≤–µ—Ç–∫–∞
   - –°–∫—Ä–∏–Ω–µ—Ä —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è —Å—Ä–µ–¥–Ω–µ—Å—Ä–æ—Å—Ä–æ—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã—Ö –∏–¥–µ–π, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –¢–ê - —Ñ–æ–∫—É—Å –Ω–∞ MOEX
   - –°–∫—Ä–∏–Ω–µ—Ä —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–µ–π. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π —Å–æ–≤–µ—Ç–Ω–∏–∫ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–π AI –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ "–ø–∞—Ä–∫–æ–≤–∫–∏" –∫–∞–ø–∏—Ç–∞–ª–∞ - —Ñ–æ–∫—É—Å –Ω–∞ MOEX

- –í—Ç–æ—Ä–∞—è –≤–µ—Ç–∫–∞
   - –¢–æ—Ä–≥–æ–≤—ã–π —Ä–æ–±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –Ω–∞ —Ä—ã–Ω–∫–µ –∏ —Ç–æ—Ä–≥–æ–≤–ª—è –∏–º–∏. –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ä–æ–±–æ—Ç –∏ —á–∞—Å—Ç—ã–µ —Å–¥–µ–ª–∫–∏ - —Ñ–æ–∫—É—Å –Ω–∞ MOEX (–¥–æ–ø) –∏ –ö—Ä–∏–ø—Ç—É (–æ—Å–Ω–æ–≤–Ω–æ–µ)

–í—Ç–æ—Ä–∞—è –≤–µ—Ç–∫–∞ –±—É–¥–µ—Ç –∏–º–µ—Ç—å Python –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –°++ –¥–ª—è –ø—Ä–æ–¥–∞. –û–±—â–µ–µ –º–µ–∂–¥—É –≤–µ—Ç–∫–∞–º–∏ - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫. –í—Ç–æ—Ä–∞—è –≤–µ—Ç–∫–∞ –±—É–¥–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏


## üéØ –û–ü–ò–°–ê–ù–ò–ï –¢–ï–ö–£–©–ï–ì–û –ü–†–û–ï–ö–¢–ê

–¢–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç —Å **Telegram-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ –±–∏—Ä–∂–∞–º–∏ (MOEX) —á–µ—Ä–µ–∑ Tinkoff Invest API. –ü—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å—Ç–∞–∫–∞–Ω—ã –∑–∞—è–≤–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–º —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ Telegram.

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üìä –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–æ–≤ —Å Tinkoff Invest API
- ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ (@trading_monitor_VB_bot)
- ‚ö° –†–µ–∂–∏–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
- üîß –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∏–∫–µ—Ä–æ–≤, –≥–ª—É–±–∏–Ω—ã —Å—Ç–∞–∫–∞–Ω–∞ –∏ —á–∞—Å—Ç–æ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –±–ª–∏–∂–∞–π—à–∏–µ –ø–ª–∞–Ω—ã:**

- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω–µ—Ä–∞ –ø–æ –¢–ê —Å–∏–≥–Ω–∞–ª–∞–º *–∏–ª–∏* —Å—Ç–∞—Ä—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ç–∫–∏

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —É–¥–æ–±–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —á–µ—Ä–µ–∑ Telegram.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

1. –û–¢–ö–†–û–ô–¢–ï –¢–ï–†–ú–ò–ù–ê–õ –ù–ê MAC:
   - –ù–∞–∂–º–∏—Ç–µ Cmd + –ü—Ä–æ–±–µ–ª
   - –í–≤–µ–¥–∏—Ç–µ "Terminal"
   - –ù–∞–∂–º–∏—Ç–µ Enter

2. –ü–ï–†–ï–ô–î–ò–¢–ï –í –ü–ê–ü–ö–£ –ü–†–û–ï–ö–¢–ê:
   ```bash
   cd ~/Desktop/#—É–∫–∞–∂–∏—Ç–µ_–≤–∞—à—É_–ø–∞–ø–∫—É#

3. –°–û–ó–î–ê–ô–¢–ï –í–ò–†–¢–£–ê–õ–¨–ù–û–ï –û–ö–†–£–ñ–ï–ù–ò–ï:
   ```bash
   python3 -m venv trading_env

4. –ê–ö–¢–ò–í–ò–†–£–ô–¢–ï –í–ò–†–¢–£–ê–õ–¨–ù–û–ï –û–ö–†–£–ñ–ï–ù–ò–ï:
   ```bash
   source trading_env/bin/activate
   
   => –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å (trading_env) –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

5. –û–ë–ù–û–í–ò–¢–ï PIP –î–û –ü–û–°–õ–ï–î–ù–ï–ô –í–ï–†–°–ò–ò:
   ```bash  
   pip install --upgrade pip

6. –£–°–¢–ê–ù–û–í–ò–¢–ï –í–°–ï –ó–ê–í–ò–°–ò–ú–û–°–¢–ò:
   ```bash  
   pip install -r requirements.txt
   
   => –≠—Ç–æ –∑–∞–π–º–µ—Ç 2-5 –º–∏–Ω—É—Ç. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–∫–æ–ª–æ 60 –ø–∞–∫–µ—Ç–æ–≤

7. –ü–†–û–í–ï–†–¨–¢–ï –£–°–¢–ê–ù–û–í–ö–£:
   ```bash  
   python scripts/check_install.py

   => –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –≥–∞–ª–æ—á–∫–∏ ‚úÖ –∏ –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫

8. –ü–†–û–í–ï–†–¨–¢–ï –°–¢–†–£–ö–¢–£–†–£ –ü–†–û–ï–ö–¢–ê:
   ```bash  
   python tests/final_structure_test.py

   => –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å ‚úÖ –¥–ª—è –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

1. –°–û–ó–î–ê–ô–¢–ï –§–ê–ô–õ .env –í –ö–û–†–ù–ï –ü–†–û–ï–ö–¢–ê:
   ```bash  
   nano .env

   –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä

2. –î–û–ë–ê–í–¨–¢–ï –°–õ–ï–î–£–Æ–©–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï:

   - **Tinkoff Invest API —Ç–æ–∫–µ–Ω** (–ø–æ–ª—É—á–∏—Ç—å –≤ –∫–∞–±–∏–Ω–µ—Ç–µ Tinkoff)

   ```bash 

   INVEST_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_—Å—é–¥–∞
   ```
   - **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã** (sandbox –∏–ª–∏ real)

   ```bash 
   SANDBOX=true
   ```
   - **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞**

   ```bash 
   TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_—Å—é–¥–∞
   TELEGRAM_CHAT_ID=–≤–∞—à_chat_id_—Å—é–¥–∞
   ```
   - **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**

   ```bash 
   DEFAULT_TICKER=DOMRF
   DEFAULT_DEPTH=5
   DEFAULT_INTERVAL=10
   LOG_LEVEL=INFO
   LOG_TO_FILE=true
   MOEX_TIMEOUT=10
   ```

3. –ö–ê–ö –ü–û–õ–£–ß–ò–¢–¨ –¢–û–ö–ï–ù–´:

- **TINKOFF INVEST API**: –ó–∞–π–¥–∏—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç Tinkoff Invest ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API ‚Üí –°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω
- **TELEGRAM BOT TOKEN**: –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram ‚Üí /newbot ‚Üí —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
- **TELEGRAM CHAT ID**: –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
   
   ```bash   
   cd telegram_bot cd telegram_bot && python get_chat_id.pycd telegram_bot && python get_chat_id.py python get_chat_id.py

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

1. –ó–ê–ü–£–°–ö –ß–ï–†–ï–ó –°–ö–†–ò–ü–¢:
   ```bash   
   python manage_bot.py start

2. –ò–õ–ò –ü–†–Ø–ú–û–ô –ó–ê–ü–£–°–ö:
   ```bash   
   source trading_env/bin/activate
   python telegram_bot/bot.py

3. –û–°–¢–ê–ù–û–í–ö–ê –ë–û–¢–ê:
   ```bash   
   python manage_bot.py stop

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –ø–æ –∏–º–µ–Ω–∏
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞: /orderbook

#### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

   ```bash   
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Tinkoff API REST (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–π—á–∞—Å –≤ –ø—Ä–æ–µ–∫—Ç–µ)
   python tests/test_tinkoff_simple.py

   # –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ —á–µ—Ä–µ–∑ gRPC
   python scripts/tinkoff_grpc_client_fixed.py get DOMRF

   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
   python manage_bot.py status # => —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
   tail -f logs/trading_bot.log   # => –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   ```

#### –î–µ–º–æ –∑–∞–ø—É—Å–∫ –∑–∞ 60 —Å–µ–∫—É–Ω–¥

   ```bash   
   # 1. –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ
   source trading_env/bin/activate

   # 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º Tinkoff API
   python scripts/tinkoff_grpc_client_fixed.py get DOMRF

   # 3. –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
   python manage_bot.py start
   ```  

–¢–µ–ø–µ—Ä—å –≤–∞—à –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! ü§ñ


## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### **–û–ë–©–ê–Ø –°–¢–†–£–ö–¢–£–†–ê**:

   ```
      python_trading/
      ‚îú‚îÄ‚îÄ src/                    # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —è–¥—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
      ‚îÇ   ‚îú‚îÄ‚îÄ data_feed/         # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      ‚îÇ   ‚îú‚îÄ‚îÄ strategies/        # –¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
      ‚îÇ   ‚îú‚îÄ‚îÄ execution/         # –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
      ‚îÇ   ‚îú‚îÄ‚îÄ risk_management/   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
      ‚îÇ   ‚îî‚îÄ‚îÄ utils/             # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
      ‚îú‚îÄ‚îÄ telegram_bot/          # Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      ‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
      ‚îÇ   ‚îú‚îÄ‚îÄ services/          # –°–µ—Ä–≤–∏—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
      ‚îÇ   ‚îî‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã –±–æ—Ç–∞
      ‚îú‚îÄ‚îÄ scripts/               # –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
      ‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã
      ‚îú‚îÄ‚îÄ config/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—á–µ—Ä–µ–∑ .env)
      ‚îú‚îÄ‚îÄ notebooks/             # Jupyter –Ω–æ—É—Ç–±—É–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
      ‚îú‚îÄ‚îÄ data/                  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
      ‚îî‚îÄ‚îÄ project_utils/         # –£—Ç–∏–ª–∏—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º

      logs
      ‚îú‚îÄ‚îÄ technical/              # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏
      ‚îÇ   ‚îú‚îÄ‚îÄ technical_2025-12-12.log
      ‚îÇ   ‚îî‚îÄ‚îÄ technical_2025-12-11.log.zip
      ‚îú‚îÄ‚îÄ business/               # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏
      ‚îÇ   ‚îú‚îÄ‚îÄ business_2025-12-12.log
      ‚îÇ   ‚îî‚îÄ‚îÄ business_2025-12-11.log.zip
      ‚îú‚îÄ‚îÄ errors/                 # –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
      ‚îÇ   ‚îú‚îÄ‚îÄ errors_2025-12-12.log
      ‚îÇ   ‚îî‚îÄ‚îÄ errors_2025-12-11.log.zip
      ‚îî‚îÄ‚îÄ trading_bot.log         # –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º
   ```

### **–î–ï–¢–ê–õ–¨–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–û–í**

```
- src/ - –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
   - data_feed/ - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –±–∏—Ä–∂:
      - moex_client.py - –ö–ª–∏–µ–Ω—Ç MOEX API (—Å—Ç–∞–∫–∞–Ω—ã, –∫–æ—Ç–∏—Ä–æ–≤–∫–∏)
      - tinkoff_client*.py - –ö–ª–∏–µ–Ω—Ç—ã Tinkoff Invest API (–±–æ–µ–≤–æ–π –∫–æ–Ω—Ç—É—Ä)
      - orderbook.py - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Å—Ç–∞–∫–∞–Ω–æ–≤
      - utils/logger.py - –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–∞–∑–µ loguru

- telegram_bot/ - Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
   - bot.py - –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞, —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
   - config.py - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞
   - handlers/ - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥:
      - basic.py - /start, /help, /status
      - settings.py - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∏–∫–µ—Ä–∞, –≥–ª—É–±–∏–Ω—ã, –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
      - orderbook.py - –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç–∞–∫–∞–Ω–∞–º–∏
   - services/ - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:
      - tinkoff_service.py - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å Tinkoff API
      - orderbook_service.py - –°–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–æ–≤

- scripts/ - –£—Ç–∏–ª–∏—Ç—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã
   - tinkoff_grpc_client_fixed.py - –ë—ã—Å—Ç—Ä—ã–π gRPC –∫–ª–∏–µ–Ω—Ç Tinkoff
   - tinkoff_scanner.py - –°–∫—Ä–∏–Ω–µ—Ä —á–µ—Ä–µ–∑ Tinkoff API REST (–±–æ–µ–≤–æ–π –∫–æ–Ω—Ç—É—Ä)

- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
   - bot_control.sh - –°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º (—Å—Ç–∞—Ä—Ç/—Å—Ç–æ–ø/–ª–æ–≥–∏)
   - requirements.txt - –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
   - .env - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
   - create_monolithic_export.py - –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
```

### **–ü–û–¢–û–ö –î–ê–ù–ù–´–•:**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (Telegram)
        ‚Üì
   –ö–æ–º–∞–Ω–¥–∞ (/orderbook)
        ‚Üì
telegram_bot/handlers/
        ‚Üì
telegram_bot/services/
        ‚Üì
   src/data_feed/
        ‚Üì
   Tinkoff API / MOEX API
        ‚Üì
    –û—Ç–≤–µ—Ç —Å–æ —Å—Ç–∞–∫–∞–Ω–æ–º
        ‚Üì
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Telegram
        ‚Üì
   –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### **–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–û–ù–ù–´–ï –£–†–û–í–ù–ò**

*–£–†–û–í–ï–ù–¨ –û–ö–†–£–ñ–ï–ù–ò–Ø (.env —Ñ–∞–π–ª)*:

- –¢–æ–∫–µ–Ω—ã API
- –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (sandbox/real)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

*–£–†–û–í–ï–ù–¨ –°–ï–ê–ù–°–ê (bot_state –≤ –ø–∞–º—è—Ç–∏)*:

- –¢–µ–∫—É—â–∏–π —Ç–∏–∫–µ—Ä
- –ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á

*–£–†–û–í–ï–ù–¨ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø (config/)*:

- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### **–¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö**:


#### **–Ø–î–†–û –ü–†–û–ï–ö–¢–ê**:
- **–Ø–∑—ã–∫**: Python 3.8+
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏**: pip + venv
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: python-dotenv (.env —Ñ–∞–π–ª—ã)

#### **API –ò –î–ê–ù–ù–´–ï**
- **Tinkoff Invest API**: gRPC + REST (–±–æ–µ–≤–æ–π –∫–æ–Ω—Ç—É—Ä –∏ sandbox)
- **MOEX ISS API**: REST (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö)
- **–î–∞–Ω–Ω—ã–µ**: pandas, numpy –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: asyncio, aiohttp –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### **TELEGRAM –ë–û–¢**
- **–û—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞**: python-telegram-bot[job-queue] v22.5+
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á**: APScheduler (–≤—Å—Ç—Ä–æ–µ–Ω –≤ JobQueue)
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: HTML-—Ä–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π

#### **–õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì**
- **–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**: loguru
- **–¢–∏–ø—ã –ª–æ–≥–æ–≤**:
  - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ (DEBUG/INFO)
  - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏ (–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
  - –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ (ERROR/CRITICAL)
- **–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤**: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è + —Å–∂–∞—Ç–∏–µ ZIP
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: –†–∞–∑–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ —Ç–∏–ø–∞–º

#### **–ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê**
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏**: bash-—Å–∫—Ä–∏–ø—Ç—ã (bot_control.sh)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è (10MB/–¥–µ–Ω—å)
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è (.env ‚Üí bot_state ‚Üí config)
- **–≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞**: –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ –¥–∞–º–ø—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

#### **–ê–†–•–ò–¢–ï–ö–¢–£–†–ê**
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ src/, telegram_bot/, scripts/
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –í–µ—Å—å —Å—Ç–µ–∫ –æ—Ç API –¥–æ Telegram
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ**: In-memory state + persistent config
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Try/except —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

#### **–£–¢–ò–õ–ò–¢–´ –ò –ò–ù–°–¢–†–£–ú–ï–ù–¢–´**
- **–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤**: –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (view_logs.sh)
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: pytest-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ç–µ—Å—Ç—ã
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: README.md + inline comments
- **–≠–∫—Å–ø–æ—Ä—Ç**: create_monolithic_export.py –¥–ª—è –¥–∞–º–ø–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

#### **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨**
- **–¢–æ–∫–µ–Ω—ã**: –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ .env (–∏—Å–∫–ª—é—á–µ–Ω –∏–∑ Git)
- **API –∫–ª—é—á–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –≤ —ç–∫—Å–ø–æ—Ä—Ç–∞—Ö
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Sandbox —Ä–µ–∂–∏–º**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫


================================================================================
–§–ê–ô–õ: bot_control.sh
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/bot_control.sh
================================================================================

#!/bin/bash

case "$1" in
    start)
        echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞..."
        cd /Users/vladimirbasov/Desktop/python_trading
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ –±–æ—Ç
        if pgrep -f "telegram_bot/bot.py" > /dev/null; then
            echo "‚ö†Ô∏è  –ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω"
            $0 status
            exit 1
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
        if [ -z "$VIRTUAL_ENV" ]; then
            source trading_env/bin/activate
            echo "‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ"
        fi
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–≤–æ–¥ –≤ –ª–æ–≥
        nohup python telegram_bot/bot.py >> logs/trading_bot.log 2>&1 &
        
        # –î–∞–µ–º –±–æ—Ç—É –≤—Ä–µ–º—è –Ω–∞ –∑–∞–ø—É—Å–∫
        sleep 2
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ª–∏
        if pgrep -f "telegram_bot/bot.py" > /dev/null; then
            BOT_PID=$(pgrep -f "telegram_bot/bot.py" | head -1)
            echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —Å PID: $BOT_PID"
            echo "üìù –õ–æ–≥–∏: tail -f logs/trading_bot.log"
        else
            echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞"
            echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: tail -50 logs/trading_bot.log"
            exit 1
        fi
        ;;
    stop)
        echo "‚èπÔ∏è  –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞..."
        
        # –ò—â–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞
        PIDS=$(pgrep -f "telegram_bot/bot.py")
        
        if [ -n "$PIDS" ]; then
            # –ü–æ—Å—ã–ª–∞–µ–º SIGTERM (—Å–∏–≥–Ω–∞–ª 15) - –º—è–≥–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
            echo "üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è..."
            kill -TERM $PIDS 2>/dev/null
            
            # –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            sleep 5
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã
            PIDS_LEFT=$(pgrep -f "telegram_bot/bot.py")
            if [ -n "$PIDS_LEFT" ]; then
                echo "‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º..."
                kill -9 $PIDS_LEFT 2>/dev/null
            fi
            
            echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        else
            echo "‚úÖ –ë–æ—Ç –Ω–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω"
        fi
        ;;
    restart)
        echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞..."
        $0 stop
        sleep 2
        $0 start
        ;;
    status)
        echo "üìä –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞:"
        PIDS=$(pgrep -f "telegram_bot/bot.py")
        if [ -n "$PIDS" ]; then
            echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω"
            echo "   –ü—Ä–æ—Ü–µ—Å—Å—ã: $PIDS"
            for PID in $PIDS; do
                echo "   - PID $PID: $(ps -p $PID -o etime= | xargs) —Ä–∞–±–æ—Ç—ã"
            done
            echo ""
            echo "   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
            echo "     $0 stop   - –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"
            echo "     $0 logsf  - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤"
        else
            echo "‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"
        fi
        ;;
    logs)
        echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –±–æ—Ç–∞:"
        if [ -f "logs/trading_bot.log" ]; then
            tail -50 logs/trading_bot.log
        else
            echo "‚ùå –§–∞–π–ª –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω"
        fi
        ;;
    logsf)
        echo "üì° –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:"
        echo "   (Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞)"
        echo ""
        if [ -f "logs/trading_bot.log" ]; then
            tail -f logs/trading_bot.log
        else
            echo "‚ùå –§–∞–π–ª –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω"
        fi
        ;;
    *)
        echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 {start|stop|restart|status|logs|logsf}"
        echo ""
        echo "–ö–æ–º–∞–Ω–¥—ã:"
        echo "  start   - –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞"
        echo "  stop    - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞"
        echo "  restart - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞"
        echo "  status  - —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞"
        echo "  logs    - –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏"
        echo "  logsf   - –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"
        ;;
esac


================================================================================
–§–ê–ô–õ: create_monolithic_export.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/create_monolithic_export.py
================================================================================

#!/usr/bin/env python3
"""
–°–æ–∑–¥–∞—ë—Ç –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º –∫–æ–¥–æ–º –ø—Ä–æ–µ–∫—Ç–∞
–ó–∞–ø—É—Å–∫: python create_monolithic_export.py [–ø—É—Ç—å_–∫_–ø—Ä–æ–µ–∫—Ç—É]
"""

import os
import sys
from pathlib import Path
from datetime import datetime

class MonolithicProjectExporter:
    def __init__(self, project_root="."):
        self.project_root = Path(project_root).resolve()
        self.output_file = None
        self.file_count = 0
        self.total_size = 0
        
        # –ü–∞–ø–∫–∏ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)
        self.exclude_dirs = {
            '.git', '__pycache__', '.pytest_cache', '.mypy_cache',
            'trading_env', 'venv', '.venv', 'env', 'virtualenv',
            'node_modules', '.vscode', '.idea', 'logs', 'data',
            'build', 'dist', '.eggs', '*.egg-info'
        }
        
        # –§–∞–π–ª—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è
        self.exclude_files = {
            '.DS_Store', 'Thumbs.db', 'desktop.ini',
            '*.pyc', '*.pyo', '*.pyd', '*.so', '*.dll',
            '*.log', '*.tmp', '*.temp', '.coverage',
            '*.db', '*.sqlite', '*.db-journal'
        }
        
        # –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –≤–∫–ª—é—á–∏—Ç—å (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å)
        self.include_extensions = {
            '.py', '.txt', '.md', '.json', '.yaml', '.yml',
            '.toml', '.ini', '.cfg', '.env', '.sh', '.bat',
            '.html', '.css', '.js', '.ts', '.sql', '.csv'
        }
        
    def should_include(self, path: Path) -> bool:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –≤–∫–ª—é—á–∞—Ç—å —Ñ–∞–π–ª"""
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫–∏
        if path.is_dir():
            return path.name not in self.exclude_dirs and not any(
                path.match(pattern) for pattern in self.exclude_dirs if '*' in pattern
            )
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã
        if any(path.match(pattern) for pattern in self.exclude_files):
            return False
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
        if path.suffix:
            return path.suffix in self.include_extensions
        
        # –§–∞–π–ª—ã –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –∏–º–µ–Ω–∏
        if path.name in ['.env', '.gitignore', 'Dockerfile', 'docker-compose.yml']:
            return True
            
        return False
    
    def sanitize_content(self, content: str, file_path: Path) -> str:
        """–û—á–∏—â–∞–µ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"""
        relative_path = str(file_path.relative_to(self.project_root))
        
        if file_path.name == '.env':
            lines = content.split('\n')
            cleaned_lines = []
            for line in lines:
                if any(keyword in line.upper() for keyword in 
                       ['TOKEN=', 'KEY=', 'SECRET=', 'PASSWORD=', 'API_']):
                    if '=' in line:
                        key = line.split('=')[0].strip()
                        cleaned_lines.append(f"{key}=[SECRET_REMOVED]")
                    else:
                        cleaned_lines.append(line)
                else:
                    cleaned_lines.append(line)
            return '\n'.join(cleaned_lines)
        
        return content
    
    def write_file_header(self, file_path: Path, relative_path: str):
        """–ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∞–π–ª–∞"""
        separator = "=" * 80
        self.output_file.write(f"\n\n{separator}\n")
        self.output_file.write(f"–§–ê–ô–õ: {relative_path}\n")
        self.output_file.write(f"–ü–û–õ–ù–´–ô –ü–£–¢–¨: {file_path}\n")
        self.output_file.write(f"{separator}\n\n")
    
    def process_file(self, file_path: Path):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–¥–∏–Ω —Ñ–∞–π–ª"""
        try:
            relative_path = str(file_path.relative_to(self.project_root))
            
            # –ü–∏—à–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            self.write_file_header(file_path, relative_path)
            
            # –ß–∏—Ç–∞–µ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            try:
                with open(file_path, 'r', encoding='utf-8') as f:
                    content = f.read()
                
                # –û—á–∏—â–∞–µ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                content = self.sanitize_content(content, file_path)
                
                # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                self.output_file.write(content)
                
                # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                self.file_count += 1
                self.total_size += len(content)
                
                print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: {relative_path} ({len(content)} –±–∞–π—Ç)")
                
            except UnicodeDecodeError:
                # –ü—Ä–æ–±—É–µ–º –¥—Ä—É–≥–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
                try:
                    with open(file_path, 'r', encoding='latin-1') as f:
                        content = f.read()
                    self.output_file.write(f"# –§–∞–π–ª –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ latin-1\n{content}")
                    self.file_count += 1
                except:
                    self.output_file.write(f"# –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∫–∞–∫ —Ç–µ–∫—Å—Ç (–±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª)\n")
                    self.output_file.write(f"# –†–∞–∑–º–µ—Ä: {file_path.stat().st_size} –±–∞–π—Ç\n")
                    
        except Exception as e:
            print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ {file_path}: {e}")
    
    def export_project(self, output_filename=None):
        """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞"""
        if not output_filename:
            timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
            output_filename = self.project_root / f"PROJECT_FULL_EXPORT_{timestamp}.txt"
        
        print(f"\nüöÄ –ù–∞—á–∏–Ω–∞–µ–º –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞")
        print(f"üìÅ –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞: {self.project_root}")
        print(f"üíæ –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª: {output_filename}")
        print("=" * 60)
        
        try:
            self.output_file = open(output_filename, 'w', encoding='utf-8')
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞
            self.write_export_header()
            
            # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã
            for root, dirs, files in os.walk(self.project_root):
                # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º root –≤ Path
                root_path = Path(root)
                
                # –§–∏–ª—å—Ç—Ä—É–µ–º –ø–∞–ø–∫–∏
                dirs[:] = [d for d in dirs if self.should_include(root_path / d)]
                
                # –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
                dirs.sort()
                files.sort()
                
                for file in files:
                    file_path = root_path / file
                    if self.should_include(file_path):
                        self.process_file(file_path)
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            self.write_statistics()
            
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª
            self.output_file.close()
            
            print("\n" + "=" * 60)
            print(f"üéâ –≠–ö–°–ü–û–†–¢ –ó–ê–í–ï–†–®–Å–ù!")
            print(f"üìä –§–∞–π–ª–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: {self.file_count}")
            print(f"üì¶ –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –∫–æ–¥–∞: {self.total_size / 1024:.1f} –ö–ë")
            print(f"üíæ –ò—Ç–æ–≥–æ–≤—ã–π —Ñ–∞–π–ª: {output_filename}")
            print(f"üìè –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {output_filename.stat().st_size / 1024 / 1024:.2f} –ú–ë")
            print("=" * 60)
            
            return output_filename
            
        except Exception as e:
            print(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
            if self.output_file:
                self.output_file.close()
            return None
    
    def write_export_header(self):
        """–ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞"""
        header = f"""
{'=' * 80}
–ú–û–ù–û–õ–ò–¢–ù–´–ô –≠–ö–°–ü–û–†–¢ –ü–†–û–ï–ö–¢–ê: {self.project_root.name}
{'=' * 80}

üìÖ –î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
üìÅ –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞: {self.project_root}
üë§ –≠–∫—Å–ø–æ—Ä—Ç—ë—Ä: MonolithicProjectExporter v1.0

{'=' * 80}
–ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
1. –§–∞–π–ª—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ —Å '======'
2. –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω—ã, –∫–ª—é—á–∏) –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ [SECRET_REMOVED]
3. –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã, —Ç–æ–ª—å–∫–æ –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
4. –í—Å–µ –ø—É—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
{'=' * 80}

"""
        self.output_file.write(header)
    
    def write_statistics(self):
        """–ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞"""
        stats = f"""

{'=' * 80}
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –≠–ö–°–ü–û–†–¢–ê
{'=' * 80}
–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: {self.file_count}
–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –∫–æ–¥–∞: {self.total_size} –±–∞–π—Ç ({self.total_size / 1024:.1f} –ö–ë)
–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
{'=' * 80}

üéØ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:
1. –ò—â–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ —Å—Ç—Ä–æ–∫–µ "–§–ê–ô–õ: "
2. –í—Å–µ –ø—É—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ: {self.project_root}
3. –î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
4. .env —Ñ–∞–π–ª—ã –æ—á–∏—â–µ–Ω—ã –æ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤

{'=' * 80}
–ö–û–ù–ï–¶ –≠–ö–°–ü–û–†–¢–ê
{'=' * 80}
"""
        self.output_file.write(stats)


def main():
    """–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞"""
    print("üîß Monolithic Project Exporter v1.0")
    print("–°–æ–∑–¥–∞—ë—Ç –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º –∫–æ–¥–æ–º –ø—Ä–æ–µ–∫—Ç–∞")
    print("=" * 60)
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
    if len(sys.argv) > 1:
        project_path = sys.argv[1]
        if not os.path.exists(project_path):
            print(f"‚ùå –ü—É—Ç—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {project_path}")
            return
    else:
        project_path = "."
    
    # –°–æ–∑–¥–∞—ë–º —ç–∫—Å–ø–æ—Ä—Ç—ë—Ä –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
    exporter = MonolithicProjectExporter(project_path)
    
    # –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ –≤—Ç–æ—Ä—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º
    output_file = None
    if len(sys.argv) > 2:
        output_file = Path(sys.argv[2])
    
    result = exporter.export_project(output_file)
    
    if result:
        print(f"\n‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {result}")
        print("\nüìã –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:")
        print(f"   –ü—Ä–æ—Å–º–æ—Ç—Ä: type {result} | more")
        print(f"   –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞: findstr /n \"–§–ê–ô–õ: main.py\" {result}")
        print(f"   –ü–æ–¥—Å—á—ë—Ç —Å—Ç—Ä–æ–∫: find /c /v \"\" {result}")
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç")

if __name__ == "__main__":
    main()

================================================================================
–§–ê–ô–õ: main.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/main.py
================================================================================

#!/usr/bin/env python3
"""
–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª trading –±–æ—Ç–∞
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º src –≤ –ø—É—Ç—å Python
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

from utils.logger import log
from data_feed.moex_client import MOEXClient

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    log.info("üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º trading –±–æ—Ç...")
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    client = MOEXClient()
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ SBER
    sber_info = client.get_security_info("SBER")
    if sber_info:
        log.info("‚úÖ MOEX API —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    log.info("üéØ Trading –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: manage_bot.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/manage_bot.py
================================================================================

#!/usr/bin/env python3
"""
–ï–¥–∏–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –±–æ—Ç–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç flood control
"""

import os
import sys
import subprocess
import time
from datetime import datetime, timedelta

class BotManager:
    def __init__(self):
        self.last_message_time = {}
        
    def is_bot_running(self):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç"""
        result = subprocess.run(['pgrep', '-f', 'telegram_bot/bot.py'], 
                               capture_output=True, text=True)
        return result.returncode == 0
    
    def get_bot_pids(self):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ PID –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–∞"""
        result = subprocess.run(['pgrep', '-f', 'telegram_bot/bot.py'], 
                               capture_output=True, text=True)
        if result.returncode == 0:
            return result.stdout.strip().split()
        return []
    
    def can_send_message(self, chat_id, min_interval_seconds=5):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–∑–∞—â–∏—Ç–∞ –æ—Ç flood)"""
        now = datetime.now()
        if chat_id not in self.last_message_time:
            return True
        
        last_time = self.last_message_time[chat_id]
        time_diff = (now - last_time).total_seconds()
        
        return time_diff >= min_interval_seconds
    
    def update_message_time(self, chat_id):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        self.last_message_time[chat_id] = datetime.now()
    
    def _send_shutdown_notification(self):
        """–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —á–µ—Ä–µ–∑ Telegram API"""
        try:
            from telegram import Bot
            from dotenv import load_dotenv
            import os
            import asyncio

            load_dotenv()
            token = os.getenv('TELEGRAM_BOT_TOKEN')
            chat_id = os.getenv('TELEGRAM_CHAT_ID')

            if not token or "–≤–∞—à_—Ç–æ–∫–µ–Ω" in token:
                print("   ‚ö†Ô∏è –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ")
                return False
            if not chat_id or "–≤–∞—à_chat_id" in chat_id:
                print("   ‚ö†Ô∏è Chat ID –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ")
                return False

            async def async_send():
                bot = Bot(token=token)
                try:
                    await bot.send_message(
                        chat_id=chat_id,
                        text="üò¥ <b>–ë–æ—Ç —É—à—ë–ª —Å–ø–∞—Ç—å</b>\n\n–î–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞",
                        parse_mode='HTML'
                    )
                    return True
                except Exception as e:
                    print(f"   ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}")
                    return False
                finally:
                    await bot.close()

            loop = asyncio.new_event_loop()
            asyncio.set_event_loop(loop)
            success = loop.run_until_complete(async_send())
            loop.close()

            return success

        except ImportError:
            print("   ‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ python-telegram-bot –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")
            return False
        except Exception as e:
            print(f"   ‚ö†Ô∏è –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}")
            return False
    
    def start_bot(self):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞"""
        print("üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞...")
        
        if self.is_bot_running():
            print("‚ö†Ô∏è  –ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω")
            print("   –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:", self.get_bot_pids())
            return False
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ bot_control.sh
        os.system("./bot_control.sh start")
        
        # –î–∞–µ–º –±–æ—Ç—É –≤—Ä–µ–º—è –Ω–∞ –∑–∞–ø—É—Å–∫
        time.sleep(3)
        
        if self.is_bot_running():
            print("‚úÖ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω")
            print("   PID:", self.get_bot_pids())
            return True
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞")
            return False
    
    def stop_bot(self):
        """–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–æ—Ç–∞ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""
        print("‚èπÔ∏è –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞...")

        if not self.is_bot_running():
            print("‚úÖ –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω")
            return True

        # 1. –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —á–µ—Ä–µ–∑ API
        print("üì§ –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram...")
        notification_sent = self._send_shutdown_notification()

        # 2. –ú—è–≥–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
        pids = self.get_bot_pids()
        print(f"üìä –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: {len(pids)}")
        os.system("./bot_control.sh stop")

        # 3. –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º
        time.sleep(5)
        remaining_pids = self.get_bot_pids()

        if remaining_pids:
            print(f"‚ö†Ô∏è {len(remaining_pids)} –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º...")
            for pid in remaining_pids:
                os.system(f"kill -9 {pid} 2>/dev/null")
            time.sleep(1)

        if not self.is_bot_running():
            print("‚úÖ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            if notification_sent:
                print("   (–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)")
            return True
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç")
            return False
    
    def restart_bot(self):
        """–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞"""
        print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞...")
        
        if self.is_bot_running():
            self.stop_bot()
            time.sleep(2)
        
        return self.start_bot()
    
    def status(self):
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞"""
        print("üìä –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞:")
        
        if self.is_bot_running():
            pids = self.get_bot_pids()
            print("‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω")
            print(f"   –ü—Ä–æ—Ü–µ—Å—Å—ã: {', '.join(pids)}")
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
            for pid in pids:
                result = subprocess.run(['ps', '-p', pid, '-o', 'etime,pid,command'], 
                                       capture_output=True, text=True)
                if result.returncode == 0:
                    lines = result.stdout.strip().split('\n')
                    if len(lines) > 1:
                        print(f"   - {lines[1]}")
        else:
            print("‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    if len(sys.argv) < 2:
        print("""
ü§ñ –ú–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
  python manage_bot.py <–∫–æ–º–∞–Ω–¥–∞>

–ö–æ–º–∞–Ω–¥—ã:
  start     - –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
  stop      - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
  restart   - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
  status    - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
  stopsoft  - –º—è–≥–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (–±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–π)
  
–ü—Ä–∏–º–µ—Ä—ã:
  python manage_bot.py start
  python manage_bot.py status
  python manage_bot.py stop
        """)
        return
    
    manager = BotManager()
    command = sys.argv[1].lower()
    
    if command == "start":
        manager.start_bot()
    elif command == "stop":
        manager.stop_bot()
    elif command == "stopsoft":
        # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å—ã, –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
        os.system("./stop_bot.py")
    elif command == "restart":
        manager.restart_bot()
    elif command == "status":
        manager.status()
    else:
        print(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: {command}")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: requirements.txt
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/requirements.txt
================================================================================

aiodns==3.5.0
aiohappyeyeballs==2.6.1
aiohttp==3.13.2
aiosignal==1.4.0
annotated-types==0.7.0
anyio==4.12.0
attrs==25.4.0
backtrader==1.9.78.123
cachetools==5.5.2
ccxt==4.5.19
certifi==2025.11.12
cffi==2.0.0
charset-normalizer==3.4.4
coincurve==21.0.0
contourpy==1.3.3
cryptography==46.0.3
cycler==0.12.1
dateparser==1.2.2
deprecation==2.1.0
fonttools==4.60.1
frozenlist==1.8.0
grpcio==1.76.0
h11==0.16.0
httpcore==1.0.9
httpx==0.28.1
idna==3.11
iso8601==2.1.0
joblib==1.5.2
kiwisolver==1.4.9
loguru==0.7.3
matplotlib==3.10.7
multidict==6.7.0
narwhals==2.11.0
numpy==2.3.4
packaging==25.0
pandas==2.3.3
pillow==12.0.0
plotly==6.4.0
prettytable==3.17.0
propcache==0.4.1
protobuf==4.25.8
pycares==4.11.0
pycparser==2.23
pycryptodome==3.23.0
pydantic==2.12.4
pydantic_core==2.41.5
pyparsing==3.2.5
python-binance==1.0.32
python-dateutil==2.9.0.post0
python-dotenv==1.2.1
python-telegram-bot==22.5
pytz==2025.2
regex==2025.11.3
requests==2.32.5
scikit-learn==1.7.2
scipy==1.16.3
seaborn==0.13.2
six==1.17.0
threadpoolctl==3.6.0
tinkoff==0.1.1
tinkoff-investments==0.2.0b117
typing-inspection==0.4.2
typing_extensions==4.15.0
tzdata==2025.2
tzlocal==5.3.1
ujson==5.11.0
urllib3==2.5.0
wcwidth==0.2.14
websocket-client==1.9.0
websockets==15.0.1
yarl==1.22.0


================================================================================
–§–ê–ô–õ: start_bot.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/start_bot.py
================================================================================

#!/usr/bin/env python3
"""
–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
"""

import os
import sys
import subprocess
from pathlib import Path

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üöÄ –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ
    if not os.path.exists("trading_env/bin/activate"):
        print("‚ùå –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
        sys.exit(1)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ –±–æ—Ç
    result = subprocess.run(["pgrep", "-f", "telegram_bot/bot.py"], 
                          capture_output=True, text=True)
    if result.stdout.strip():
        print("‚ö†Ô∏è  –ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω")
        print("   –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:")
        for pid in result.stdout.strip().split():
            subprocess.run(["ps", "-p", pid, "-o", "pid,etime,command"])
        sys.exit(1)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    print("üì° –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞...")
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º nohup –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ñ–æ–Ω–µ
    with open("logs/trading_bot.log", "a") as logfile:
        process = subprocess.Popen(
            [
                "nohup",
                "trading_env/bin/python",
                "telegram_bot/bot.py"
            ],
            stdout=logfile,
            stderr=subprocess.STDOUT
        )
    
    print(f"‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —Å PID: {process.pid}")
    print("üìù –õ–æ–≥–∏: tail -f logs/trading_bot.log")
    print("‚èπÔ∏è  –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ./bot_control.sh stop")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: stop_bot.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/stop_bot.py
================================================================================

#!/usr/bin/env python3
"""
–ü—Ä–æ—Å—Ç–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞ - —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
"""

import os
import sys
import subprocess
import time

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)...")
    
    # –ò—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞
    result = subprocess.run(['pgrep', '-f', 'telegram_bot/bot.py'], 
                           capture_output=True, text=True)
    
    if result.returncode != 0:
        print("‚úÖ –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω")
        return
    
    pids = result.stdout.strip().split()
    print(f"üìä –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–∞: {len(pids)}")
    
    if not pids:
        print("‚úÖ –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω")
        return
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º SIGTERM (–º—è–≥–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
    print("üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è...")
    for pid in pids:
        print(f"  - PID {pid}: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º SIGTERM")
        os.system(f"kill -TERM {pid} 2>/dev/null || true")
    
    # –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã
    time.sleep(3)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã
    result = subprocess.run(['pgrep', '-f', 'telegram_bot/bot.py'], 
                           capture_output=True, text=True)
    
    if result.returncode == 0:
        pids = result.stdout.strip().split()
        print(f"‚ö†Ô∏è  {len(pids)} –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º...")
        for pid in pids:
            print(f"  - PID {pid}: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º SIGKILL")
            os.system(f"kill -9 {pid} 2>/dev/null || true")
    
    print("‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: testGit.txt
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/testGit.txt
================================================================================



================================================================================
–§–ê–ô–õ: test_bot_monitoring.sh
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/test_bot_monitoring.sh
================================================================================

#!/bin/bash

echo "=== –¢–µ—Å—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞–∫–∞–Ω–∞ ==="
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–æ–≤..."
if [ ! -f ".env" ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º Python
echo "üêç –ü—Ä–æ–≤–µ—Ä—è–µ–º Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
source trading_env/bin/activate 2>/dev/null || echo "‚ö†Ô∏è  –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ"

# 3. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞
echo "üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞..."
python tests/test_monitoring.py

echo ""
echo "=== –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ==="
echo "1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: ./bot_control.sh start"
echo "2. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞"
echo "3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "   /ticker SBER      - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∏–∫–µ—Ä"
echo "   /depth 5          - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–ª—É–±–∏–Ω—É"
echo "   /interval 30      - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª 30 —Å–µ–∫—É–Ω–¥"
echo "   /start_monitoring - –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
echo "4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç–∞–∫–∞–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥"
echo "5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: /stop_monitoring"
echo ""
echo "üìä –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤: ./bot_control.sh logsf"


================================================================================
–§–ê–ô–õ: test_stop_messages.sh
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/test_stop_messages.sh
================================================================================

#!/bin/bash
echo "=== –¢–µ—Å—Ç 1: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ manage_bot.py ==="
python manage_bot.py start
sleep 5
echo "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ manage_bot.py stop..."
python manage_bot.py stop
echo ""
sleep 5

echo "=== –¢–µ—Å—Ç 2: –†—É—á–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (Ctrl+C) ==="
echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –≤—Ä—É—á–Ω—É—é –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:"
echo "cd ~/Desktop/python_trading && source trading_env/bin/activate && python telegram_bot/bot.py"
echo "–ó–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ Ctrl+C –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
echo ""
echo "=== –¢–µ—Å—Ç 3: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ bot_control.sh ==="
python manage_bot.py start
sleep 3
echo "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ ./bot_control.sh stop..."
./bot_control.sh stop
sleep 5
python manage_bot.py status


================================================================================
–§–ê–ô–õ: T_Api_Docs/src/docs/errors/api_errors.json
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/T_Api_Docs/src/docs/errors/api_errors.json
================================================================================

{
  "12001": {
    "message": "Method is unimplemented",
    "type": "UNIMPLEMENTED",
    "description": "–ú–µ—Ç–æ–¥ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω."
  },
  "12002": {
    "message": "Deprecated method is unavailable",
    "type": "UNAVAILABLE",
    "description": "–ú–µ—Ç–æ–¥ —É—Å—Ç–∞—Ä–µ–ª –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω."
  },
  "30001": {
    "message": "missing parameter: 'from'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *from* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *from*."
  },
  "30002": {
    "message": "the required period should not exceed 7 days",
    "type": "INVALID_ARGUMENT",
    "description": "–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 7 –¥–Ω–µ–π.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥."
  },
  "30003": {
    "message": "'from' can't be less than the current date",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *from* –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *from*."
  },
  "30004": {
    "message": "missing parameter: 'to'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *to* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *to*."
  },
  "30005": {
    "message": "'id_type' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *id_type* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: [*id_type*](https://tinkoff.github.io/investAPI/instruments#instrumentidtype)."
  },
  "30006": {
    "message": "missing parameter: 'id_type'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *id_type* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *id_type*."
  },
  "30007": {
    "message": "missing parameter: 'id'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *id* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *id*."
  },
  "30008": {
    "message": "missing parameter: 'figi'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *figi* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *figi*."
  },
  "30009": {
    "message": "'from' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *from* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *from*."
  },
  "30010": {
    "message": "'to' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *to* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *to*."
  },
  "30011": {
    "message": "interval is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *interval* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: [*interval*](https://tinkoff.github.io/investAPI/marketdata#subscriptioninterval)."
  },
  "30012": {
    "message": "'to' can't be less than 'from'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *to* –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ *from*.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã *from* –∏ *to*."
  },
  "30013": {
    "message": "'class_code' require for 'id_type' = 'ticker'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *class_code* –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ —Ç–∏–∫–µ—Ä—É.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *class_code*.</br>–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤](https://tinkoff.github.io/investAPI/faq_identification/)."
  },
  "30014": {
    "message": "the maximum request period for the given candle interval has been exceeded",
    "type": "INVALID_ARGUMENT",
    "description": "–ü—Ä–µ–≤—ã—à–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Å–≤–µ—á–∏.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª.</br>–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã —Å–≤–µ—á–µ–π –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã](https://tinkoff.github.io/investAPI/load_history/)."
  },
  "30015": {
    "message": "parameter 'quantity' is missing or equal to 0",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *quantity* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *quantity*."
  },
  "30016": {
    "message": "'quantity' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *quantity* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *quantity*."
  },
  "30017": {
    "message": "missing parameter: 'price'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *price* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *price*.</br>–ó–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ *price* –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º.</br>units –∏ nanos –Ω–µ –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞–∫ –∏ –º–æ–¥—É–ª—å nanos –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < 999 999 999"
  },
  "30018": {
    "message": "price is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *price* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *price*."
  },
  "30019": {
    "message": "missing parameter: 'direction'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *direction* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *direction*."
  },
  "30020": {
    "message": "'direction' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *direction* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ."
  },
  "30021": {
    "message": "missing parameter: 'account_id'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *account_id* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *account_id*."
  },
  "30022": {
    "message": "missing parameter: 'state'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *state* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *state*.</br>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: [*direction*](https://tinkoff.github.io/investAPI/operations/#operationstate)."
  },
  "30023": {
    "message": "invalid parameter: 'state'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *state* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *state*.</br>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: [*direction*](https://tinkoff.github.io/investAPI/operations/#operationstate)."
  },
  "30025": {
    "message": "missing parameter: 'order_type'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *order_type* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *order_type*. –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: [*order_type*](https://tinkoff.github.io/investAPI/orders/#ordertype)."
  },
  "30026": {
    "message": "invalid parameter: 'order_type'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *order_type* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *order_type*."
  },
  "30027": {
    "message": "missing parameter: 'order_id'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *order_id* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *order_id*."
  },
  "30028": {
    "message": "'order id' is invalid UUID format.",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *order_id* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *order_id* —Ñ–æ—Ä–º–∞—Ç–∞ UUID. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ 36 —Å–∏–º–≤–æ–ª–æ–≤."
  },
  "30029": {
    "message": "missing parameter: 'idempotency_key'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *idempotency_key* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *idempotency_key*."
  },
  "30030": {
    "message": "'idempotency_key' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *idempotency_key* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *idempotency_key*. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ 36 —Å–∏–º–≤–æ–ª–æ–≤."
  },
  "30031": {
    "message": "missing parameter: 'depth'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *depth* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *depth*."
  },
  "30032": {
    "message": "depth is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *depth* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *depth*."
  },
  "30033": {
    "message": "missing parameter: 'trade_clearing_account' or 'class_code'",
    "type": "INVALID_ARGUMENT",
    "description": "–ü–∞—Ä–∞–º–µ—Ç—Ä *trade_clearing_account* –∏–ª–∏ *class_code* –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º."
  },
  "30034": {
    "message": "not enough balance",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏ (–æ—à–∏–±–∫–∞ –ø–µ—Å–æ—á–Ω–∏—Ü—ã).</br>–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –Ω—É–∂–Ω–æ–π –≤–∞–ª—é—Ç—ã c –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ [*SandboxPayIn*](https://tinkoff.github.io/investAPI/sandbox#sandboxpayin)."
  },
  "30036": {
    "message": "missing parameter: 'stop_price'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *stop_price* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *stop_price*."
  },
  "30037": {
    "message": "missing parameter: 'stop_order_type'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *stop_order_type* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *stop_order_type*."
  },
  "30038": {
    "message": "'stop_order_type' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *stop_order_type* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: [*stop_order_type*](https://tinkoff.github.io/investAPI/stoporders/#stopordertype)."
  },
  "30040": {
    "message": "'expire_date' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *expire_date* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *expire_date*."
  },
  "30041": {
    "message": "the method is available only for futures",
    "type": "INVALID_ARGUMENT",
    "description": "–ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ—å—é—á–µ—Ä—Å–∞–º–∏.</br>–ü–µ—Ä–µ–¥–∞–π—Ç–µ –≤–æ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ñ—å—é—á–µ—Ä—Å–∞."
  },
  "30042": {
    "message": "not enough assets for a margin trade",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–∫—Ç–∏–≤–æ–≤ –¥–ª—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ–π —Å–¥–µ–ª–∫–∏.</br>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å—á—ë—Ç–∞. –í—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ [*GetMarginAttributes*](https://tinkoff.github.io/investAPI/users#getmarginattributes)."
  },
  "30043": {
    "message": "missing parameter: 'expiration_type'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *expiration_type* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *expiration_type*."
  },
  "30044": {
    "message": "'expiration_type' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *expiration_type* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: [*expiration_type*](https://tinkoff.github.io/investAPI/stoporders/#stoporderexpirationtype)."
  },
  "30045": {
    "message": "missing parameter: 'ticker'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *ticker* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *ticker*."
  },
  "30047": {
    "message": "price currency does not match the settlement currency",
    "type": "INVALID_ARGUMENT",
    "description": "–í–∞–ª—é—Ç–∞ —Ü–µ–Ω—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–∞–ª—é—Ç–æ–π —Ä–∞—Å—á—ë—Ç–æ–≤ –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –≤–∞–ª—é—Ç—É —Ü–µ–Ω—ã. –£–∑–Ω–∞—Ç—å –≤–∞–ª—é—Ç—É —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤—ã –º–æ–∂–µ—Ç–µ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ [*GetInstrumentBy*](https://tinkoff.github.io/investAPI/instruments#getinstrumentby). "
  },
  "30048": {
    "message": "instrument type is not bond",
    "type": "INVALID_ARGUMENT",
    "description": "–ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –æ–±–ª–∏–≥–∞—Ü–∏–∏.</br>–ü–µ—Ä–µ–¥–∞–π—Ç–µ –≤–æ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±–ª–∏–≥–∞—Ü–∏–∏."
  },
  "30049": {
    "message": "post order error: %s",
    "type": "INVALID_ARGUMENT",
    "description": "–û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –ø–æ—Ä—É—á–µ–Ω–∏—è.</br>–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ç–µ–∫—Å—Ç–µ –æ—à–∏–±–∫–∏."
  },
  "30050": {
    "message": "'instrument_status' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *instrument_status* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: [*instrument_status*](https://tinkoff.github.io/investAPI/instruments#instrumentstatus)."
  },
  "30051": {
    "message": "account margin status is disabled",
    "type": "INVALID_ARGUMENT",
    "description": "–î–ª—è –¥–∞–Ω–Ω–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è.</br>–î–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ä—É—á–µ–Ω–∏–π –Ω–∞ —Å—Ä–æ—á–Ω–æ–º —Ä—ã–Ω–∫–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ."
  },
  "30052": {
    "message": "instrument forbidden for trading by API",
    "type": "INVALID_ARGUMENT",
    "description": "–î–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—è —á–µ—Ä–µ–∑ API.</br>–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ api_trade_available_flag –¥–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ c –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ [*GetTradingStatus*](https://tinkoff.github.io/investAPI/marketdata#gettradingstatus)."
  },
  "30053": {
    "message": "post stop_order error: %s",
    "type": "INVALID_ARGUMENT",
    "description": "–û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç–æ–ø-–∑–∞—è–≤–∫–∏.</br>–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ç–µ–∫—Å—Ç–µ –æ—à–∏–±–∫–∏."
  },
  "30054": {
    "message": "instrument type is not a share or etf",
    "type": "INVALID_ARGUMENT",
    "description": "–¢–∏–ø –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –Ω–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π —Ñ–æ–Ω–¥ –∏–ª–∏ –∞–∫—Ü–∏—è"
  },
  "30055": {
    "message": "order_id cannot be longer than 36 characters",
    "type": "INVALID_ARGUMENT",
    "description": "order_id –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 36 —Å–∏–º–≤–æ–ª–æ–≤"
  },
  "30056": {
    "message": "stop order settlement currency is not supported",
    "type": "INVALID_ARGUMENT",
    "description": "–í–∞–ª—é—Ç–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç–æ–ø-–∑–∞—è–≤–∫–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"
  },
  "30057": {
    "message": "the order is a duplicate, but the order report was not found",
    "type": "INVALID_ARGUMENT",
    "description": "–ó–∞—è–≤–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –¥—É–±–ª–µ–º, –Ω–æ –æ—Ç—á–µ—Ç –ø–æ –∑–∞—è–≤–∫–µ –Ω–µ –Ω–∞–π–¥–µ–Ω.</br>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä order_id (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ä—É—á–µ–Ω–∏—è –¥–ª—è —Ü–µ–ª–µ–π –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.) - –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º."
  },
  "30058": {
    "message": "task not completed yet, please try again later",
    "type": "INVALID_ARGUMENT",
    "description": "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
  },
  "30059": {
    "message": "cancel order error: %s",
    "type": "INVALID_ARGUMENT",
    "description": "–û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–∞ –æ—Ç–º–µ–Ω—ã –∑–∞—è–≤–∫–∏.</br>–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ç–µ–∫—Å—Ç–µ –æ—à–∏–±–∫–∏."
  },
  "30060": {
    "message": "cancel stop-order error: %s",
    "type": "INVALID_ARGUMENT",
    "description": "–û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–∞ –æ—Ç–º–µ–Ω—ã —Å—Ç–æ–ø-–∑–∞—è–≤–∫–∏.</br>–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ç–µ–∫—Å—Ç–µ –æ—à–∏–±–∫–∏."
  },
  "30061": {
    "message": "'from' value out of range",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *from* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç 1970-01-01T00:00:00Z –¥–æ 2099-12-31T23:59:59.999999999Z –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ."
  },
  "30062": {
    "message": "'to' value out of range",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *to* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç 1970-01-01T00:00:00Z –¥–æ 2099-12-31T23:59:59.999999999Z –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ."
  },
  "30063": {
    "message": "'expire_date' value out of range",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *expire_date* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ —Ä–∞–Ω–µ–µ —Ç–µ–∫—É—â–µ–π –∏ –Ω–µ –ø–æ–∑–¥–Ω–µ–µ 2099-12-31T23:59:59.999999999Z."
  },
  "30064": {
    "message": "the required period should not exceed 31 days",
    "type": "INVALID_ARGUMENT",
    "description": "–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 31 –¥–Ω—è.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥."
  },
  "30065": {
    "message": "missing parameter: 'task_id'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *task_id* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *task_id*."
  },
  "30066": {
    "message": "missing parameter: 'payload'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *payload* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *payload*."
  },
  "30067": {
    "message": "'action_type' is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ *action_type*.</br>–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ."
  },
  "30068": {
    "message": "Only limit order is allowed",
    "type": "INVALID_ARGUMENT",
    "description": "–í –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç –≤–æ–∑–º–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ª–∏–º–∏—Ç–Ω–æ–≥–æ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –ø–æ—Ä—É—á–µ–Ω–∏—è. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ [–≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–æ—Ä—É—á–µ–Ω–∏–π](https://tinkoff.github.io/investAPI/orders_details)."
  },
  "30069": {
    "message": "Invalid parameter: 'limit'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *limit* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ 1000."
  },
  "30070": {
    "message": "'from' can't be more than the current date",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *from* –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.</br>–£–∫–∞–∂–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—â–µ–µ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è."
  },
  "30077": {
    "message": "not available for OTC instruments",
    "type": "INVALID_ARGUMENT",
    "description": "–ú–µ—Ç–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤–Ω–µ–±–∏—Ä–∂–µ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.</br>–£ —Ç–∞–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä api_trade_available_flag –º–µ—Ç–æ–¥–∞ [*GetTradingStatus*](https://tinkoff.github.io/investAPI/marketdata#gettradingstatus) –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ false."
  },
  "30078": {
    "message": "Incorrect minimum price increment",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —à–∞–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã.</br>–û—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è price –Ω–∞ min_price_increment –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–≤–µ–Ω 0."
  },
  "30079": {
    "message": "instrument is not available for trading",
    "type": "INVALID_ARGUMENT",
    "description": "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ç–æ—Ä–≥–æ–≤. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ [—Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç–∞—Ç—É—Å–∞—Ö](https://tinkoff.github.io/investAPI/faq_trading_status)."
  },
  "30080": {
    "message": "quantity must be positive",
    "type": "INVALID_ARGUMENT",
    "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ—Ç–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º."
  },
  "30081": {
    "message": "account status is closed",
    "type": "INVALID_ARGUMENT",
    "description": "–ê–∫–∫–∞—É–Ω—Ç –∑–∞–∫—Ä—ã—Ç."
  },
  "30082": {
    "message": "account status is blocked",
    "type": "INVALID_ARGUMENT",
    "description": "–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω."
  },
  "30083": {
    "message": "order_type is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–∏–ø –∑–∞—è–≤–∫–∏."
  },
  "30084": {
    "message": "maximum request period has been exceeded",
    "type": "INVALID_ARGUMENT",
    "description": "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞."
  },
  "30085": {
    "message": "price in points is available only for futures and bonds",
    "type": "INVALID_ARGUMENT",
    "description": "–¢–∏–ø —Ü–µ–Ω—ã –≤ –ø—É–Ω–∫—Ç–∞—Ö –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤ –∏ –æ–±–ª–∏–≥–∞—Ü–∏–π."
  },
  "30086": {
    "message": "year is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥."
  },
  "30087": {
    "message": "missing parameter: query",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *query* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –Ω–µ –ø—É—Å—Ç–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *query*."
  },
  "30088": {
    "message": "'from' and 'to' must have the same year",
    "type": "INVALID_ARGUMENT",
    "description": "–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –¥–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –≥–æ–¥–∞."
  },
  "30089": {
    "message": "'to' must not be later than %s",
    "type": "INVALID_ARGUMENT",
    "description": "–ü–æ–ª–µ to –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–∑–¥–Ω–µ–µ –¥–∞—Ç—ã, —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤ —Ç–µ–∫—Å—Ç–µ –æ—à–∏–±–∫–∏.</br>–î–∞—Ç–∞ —É–∫–∞–∑–∞–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601."
  },
  "30090": {
    "message": "missing parameter: 'siebel_id'",
    "type": "INVALID_ARGUMENT",
    "description": "–í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä *siebel_id* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä *siebel_id*."
  },
  "30091": {
    "message": "quantity of instruments can't be more than 100",
    "type": "INVALID_ARGUMENT",
    "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 100."
  },
  "30092": {
    "message": "trading unavailable on weekends",
    "type": "INVALID_ARGUMENT",
    "description": "–¢–æ—Ä–≥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –Ω–µ—Ä–∞–±–æ—á–∏–º –¥–Ω—è–º. –ë–æ–ª—å—à–µ –æ [—Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Å—Å–∏—è—Ö](https://tinkoff.github.io/investAPI/markets)."
  },
  "30093": {
    "message": "missing parameter: 'figi' or 'instrument_id'",
    "type": "INVALID_ARGUMENT",
    "description": "–û–¥–∏–Ω –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ *figi* –∏–ª–∏ *instrument_id* —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º."
  },
  "30094": {
    "message": "options trading is not available at the moment",
    "type": "INVALID_ARGUMENT",
    "description": "–í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –ø–æ –æ–ø—Ü–∏–æ–Ω–∞–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ."
  },
  "30095": {
    "message": "the request was not executed by the exchange",
    "type": "INVALID_ARGUMENT",
    "description": "–ó–∞—è–≤–∫–∞ –Ω–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∞ –±–∏—Ä–∂–µ–π.</br>–õ–∏–º–∏—Ç–Ω–∞—è –∑–∞—è–≤–∫–∞ –º–æ–∂–µ—Ç –Ω–µ –∏—Å–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ –ø—Ä–∏—á–∏–Ω–µ –Ω–µ–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Ü–µ–Ω—ã –Ω–∞ –±–∏—Ä–∂–µ.</br>–†—ã–Ω–æ—á–Ω–∞—è –∂–µ –º–æ–∂–µ—Ç –Ω–µ –∏—Å–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ –ø—Ä–∏—á–∏–Ω–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–¥–µ–ª–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–Ω–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å)."
  },
  "30096": {
    "message": "the order was rejected, try again later",
    "type": "INVALID_ARGUMENT",
    "description": "–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∑–∂–µ."
  },
  "30097": {
    "message": "inappropriate trading session",
    "type": "INVALID_ARGUMENT",
    "description": "–°–µ–π—á–∞—Å —ç—Ç–∞ —Å–µ—Å—Å–∏—è –Ω–µ –∏–¥—ë—Ç. –ë–æ–ª—å—à–µ –æ [—Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Å—Å–∏—è—Ö](https://tinkoff.github.io/investAPI/markets)."
  },
  "30098": {
    "message": "currently, there is no trading on this financial instrument",
    "type": "INVALID_ARGUMENT",
    "description": "–¢–æ—Ä–≥–∏ –ø–æ —ç—Ç–æ–º—É —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–º—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É —Å–µ–π—á–∞—Å –Ω–µ –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è.</br>–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ [*GetTradingStatus*](https://tinkoff.github.io/investAPI/marketdata#gettradingstatus)."
  },
  "30099": {
    "message": "the price is outside the limits for this instrument",
    "type": "INVALID_ARGUMENT",
    "description": "–¶–µ–Ω–∞ –≤–Ω–µ –ª–∏–º–∏—Ç–æ–≤ –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –∏–ª–∏ —Ü–µ–Ω–∞ —Å–¥–µ–ª–∫–∏ –≤–Ω–µ –ª–∏–º–∏—Ç–∞. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ [–≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–æ—Ä—É—á–µ–Ω–∏–π](https://tinkoff.github.io/investAPI/orders_details)."
  },
  "30100": {
    "message": "the price must be positive",
    "type": "INVALID_ARGUMENT",
    "description": "–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π."
  },
  "30101": {
    "message": "to trade this financial instrument, pass the test",
    "type": "INVALID_ARGUMENT",
    "description": "–î–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ —ç—Ç–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –ø—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –û —Ç–æ–º, –∫–∞–∫ —Å–¥–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–º—É –æ–Ω–æ –Ω—É–∂–Ω–æ —á–∏—Ç–∞–π—Ç–µ [—Ç—É—Ç](https://www.tinkoff.ru/blog/articles/test-invest/)."
  },
  "30102": {
    "message": "Required parameters missing",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã."
  },
  "30103": {
    "message": "Only best price is allowed",
    "type": "INVALID_ARGUMENT",
    "description": "–î–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Ç–æ–ª—å–∫–æ —Ç–∏–ø–∞ –ª—É—á—à–∞—è —Ü–µ–Ω–∞"
  },
  "30104": {
    "message": "price_type is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ *price_type*. –ó–Ω–∞—á–µ–Ω–∏–µ–º *price_type* –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ **PRICE_TYPE_POINT** –ò–õ–ò **PRICE_TYPE_CURRENCY**."
  },
  "30105": {
    "message": "exchange_order_type is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ *exchange_order_type*. –ó–Ω–∞—á–µ–Ω–∏–µ–º *exchange_order_type* –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ **LIMIT** –ò–õ–ò **MARKET**."
  },
  "30106": {
    "message": "status is invalid",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ *status*. –ó–Ω–∞—á–µ–Ω–∏–µ–º *status* –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ **ACTIVE**, **EXCECUTED**, **CANCELED** –ò **EXPIRED**."
  },
  "30107": {
    "message": "negative values are not allowed",
    "type": "INVALID_ARGUMENT",
    "description": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ *limit* –∏/–∏–ª–∏ *page*. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã *limit* –∏ *page* –Ω–µ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ—Ç–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è."
  },
  "30108": {
    "message": "specify a lower limit or page value because there are fewer brands",
    "type": "INVALID_ARGUMENT",
    "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–µ–Ω–¥–æ–≤ –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤."
  },
  "40002": {
    "message": "insufficient privileges",
    "type": "PERMISSION_DENIED",
    "description": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.</br>–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∏–º–µ–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø—Ä–∞–≤ read-only, –ª–∏–±–æ —É —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —Å—á–µ—Ç—É.</br>–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–í–∏–¥—ã —Ç–æ–∫–µ–Ω–æ–≤](https://tinkoff.github.io/investAPI/index#_2)"
  },
  "40003": {
    "message": "authentication token is missing or invalid",
    "type": "UNAUTHENTICATED",
    "description": "–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω.</br>–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ [–ù–∞—Å—Ç—Ä–æ–π–∫–∏](https://www.tinkoff.ru/invest/settings/)"
  },
  "40004": {
    "message": "Working with orders is not available with this account",
    "type": "PERMISSION_DENIED",
    "description": "–í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ —Å —Ç–µ–∫—É—â–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.</br>–ë—Ä–æ–∫–µ—Ä—Å–∫–∏–π —Å—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç, –ª–∏–±–æ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–æ—Ç Tinkoff Invest API –∏–ª–∏ –æ—Ç –±–∏—Ä–∂–∏). –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É. "
  },

  "50001": {
    "message": "exchange not found",
    "type": "NOT_FOUND",
    "description": "–ë–∏—Ä–∂–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É *exchange_id*.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π *exchange_id*."
  },
  "50002": {
    "message": "instrument not found",
    "type": "NOT_FOUND",
    "description": "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞."
  },
  "50004": {
    "message": "account not found",
    "type": "NOT_FOUND",
    "description": "–°—á—ë—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É *account_id*.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π *account_id*."
  },
  "50005": {
    "message": "order not found",
    "type": "NOT_FOUND",
    "description": "–¢–æ—Ä–≥–æ–≤–æ–µ –ø–æ—Ä—É—á–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É *order_id*.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π *order_id*."
  },
  "50006": {
    "message": "stop-order not found",
    "type": "NOT_FOUND",
    "description": "–°—Ç–æ–ø-–∑–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É *stop_order_id*.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π *stop_order_id*."
  },
  "50007": {
    "message": "task not found",
    "type": "NOT_FOUND",
    "description": "–ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
  },
  "50008": {
    "message": "no orderbook provider",
    "type": "NOT_FOUND",
    "description": "–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å—Ç–∞–∫–∞–Ω–∞–º."
  },
  "50009": {
    "message": "asset not found",
    "type": "NOT_FOUND",
    "description": "–ê–∫—Ç–∏–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–∞."
  },
  "50010": {
    "message": "brand not found",
    "type": "NOT_FOUND",
    "description": "–ë—Ä–µ–Ω–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω.</br>–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±—Ä–µ–Ω–¥–∞."
  },
  "70001": {
    "message": "internal error",
    "type": "INTERNAL",
    "description": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–∏—Å–∞.</br>–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏."
  },
  "70002": {
    "message": "internal network error",
    "type": "INTERNAL",
    "description": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–∑–¥–Ω–µ–µ.</br>–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏."
  },
  "70003": {
    "message": "internal error, please try again later",
    "type": "INTERNAL",
    "description": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–∏—Å–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–∑–¥–Ω–µ–µ.</br>–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏."
  },
  "80001": {
    "message": "limit of open streams exceeded",
    "type": "RESOURCE_EXHAUSTED",
    "description": "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö stream-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–õ–∏–º–∏—Ç–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞](https://tinkoff.github.io/investAPI/limits/)"
  },
  "80002": {
    "message": "request limit exceeded",
    "type": "RESOURCE_EXHAUSTED",
    "description": "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–õ–∏–º–∏—Ç–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞](https://tinkoff.github.io/investAPI/limits/)"
  },
  "80003": {
    "message": "The limit on SMS sending has been exceeded, try again in a minute",
    "type": "RESOURCE_EXHAUSTED",
    "description": "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –°–ú–°, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É. –ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –°–ú–° –ø—Ä–∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏, –æ—Ç–∫–ª—é—á–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –°–ú–° –≤ –õ–ö."
  },
  "90001": {
    "message": "need confirmation: %s",
    "type": "FAILED_PRECONDITION",
    "description": "–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.</br>–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ç–µ–∫—Å—Ç–µ –æ—à–∏–±–∫–∏."
  },
  "90002": {
    "message": "only for qualified investors",
    "type": "FAILED_PRECONDITION",
    "description": "–¢–æ—Ä–≥–æ–≤–ª—è —ç—Ç–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞–º."
  },
  "90003": {
    "message": "The price is too high",
    "type": "FAILED_PRECONDITION",
    "description": "–¶–µ–Ω–∞ –∑–∞—è–≤–∫–∏ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è. –†–∞–∑–±–µ–π—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ –∑–∞—è–≤–∫–∏ –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞—è–≤–∫–∏](https://tinkoff.github.io/investAPI/faq_orders/)."
  }
}


================================================================================
–§–ê–ô–õ: project_utils/export_project.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/project_utils/export_project.py
================================================================================

#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
–ó–∞–ø—É—Å–∫: python project_utils/export_project.py
"""

import os
import json
import base64
from datetime import datetime

def export_project():
    """–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –≤ –æ–¥–∏–Ω JSON —Ñ–∞–π–ª"""
    print("üì§ –í—ã–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞...")
    
    project_data = {
        "export_date": datetime.now().isoformat(),
        "project_name": "Python Trading Bot",
        "files": {}
    }
    
    # –ò—Å–∫–ª—é—á–∞–µ–º—ã–µ –ø–∞–ø–∫–∏ –∏ —Ñ–∞–π–ª—ã
    exclude_dirs = {'.git', '__pycache__', 'trading_env', 'data', 'logs'}
    exclude_files = {'.DS_Store'}
    
    # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
    for root, dirs, files in os.walk("."):
        # –ò—Å–∫–ª—é—á–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–ø–∫–∏
        dirs[:] = [d for d in dirs if d not in exclude_dirs]
        
        for file in files:
            if file in exclude_files:
                continue
                
            file_path = os.path.join(root, file)
            relative_path = file_path[2:]  # —É–±–∏—Ä–∞–µ–º ./
            
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∞–º —Å–∫—Ä–∏–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞
            if "project_utils/export_project.py" in relative_path:
                continue
                
            try:
                with open(file_path, 'r', encoding='utf-8') as f:
                    content = f.read()
                
                # –î–ª—è .env —Ñ–∞–π–ª–∞ –∑–∞–º–µ–Ω—è–µ–º —Ç–æ–∫–µ–Ω –Ω–∞ placeholder
                if file == '.env':
                    lines = content.split('\n')
                    new_lines = []
                    for line in lines:
                        if line.startswith('INVEST_TOKEN='):
                            new_lines.append('INVEST_TOKEN=–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω')
                        else:
                            new_lines.append(line)
                    content = '\n'.join(new_lines)
                
                project_data["files"][relative_path] = {
                    "content": content,
                    "size": len(content),
                    "encoding": "utf-8"
                }
                
                print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: {relative_path}")
                
            except Exception as e:
                print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è {relative_path}: {e}")
                project_data["files"][relative_path] = {
                    "content": f"# –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: {e}",
                    "size": 0,
                    "error": str(e)
                }
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª
    output_filename = f"project_export_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
    
    try:
        with open(output_filename, 'w', encoding='utf-8') as f:
            json.dump(project_data, f, indent=2, ensure_ascii=False)
        
        file_size = os.path.getsize(output_filename) / 1024 / 1024
        print(f"\nüéâ –ü—Ä–æ–µ–∫—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤: {output_filename}")
        print(f"üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {file_size:.2f} MB")
        print(f"üìÅ –§–∞–π–ª–æ–≤ –≤ —ç–∫—Å–ø–æ—Ä—Ç–µ: {len(project_data['files'])}")
        print("\nüìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–æ–µ–∫—Ç–∞:")
        
        # –í—ã–≤–æ–¥–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        for file_path in sorted(project_data["files"].keys()):
            file_info = project_data["files"][file_path]
            print(f"  - {file_path} ({file_info['size']} –±–∞–π—Ç)")
            
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞: {e}")
        return False

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üöÄ Trading Bot Project Exporter")
    print("=" * 50)
    print("–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –æ–¥–∏–Ω JSON —Ñ–∞–π–ª")
    print("–¢–æ–∫–µ–Ω API –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω'")
    print("=" * 50)
    
    success = export_project()
    
    if success:
        print("\n‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!")
        print("üí° –ü–µ—Ä–µ–¥–∞–π—Ç–µ JSON —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞")
    else:
        print("\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: scripts/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/scripts/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: scripts/check_install.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/scripts/check_install.py
================================================================================

#!/usr/bin/env python3
"""
–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞
"""

import sys
from pathlib import Path

project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

print("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫...")
print("=" * 50)

# –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
critical_libs = [
    ("grpc", "–ë–∞–∑–æ–≤—ã–π gRPC —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ (–¥–ª—è Tinkoff API)", "grpcio"),
    ("tinkoff.invest", "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python –∫–ª–∏–µ–Ω—Ç Tinkoff Invest API", "tinkoff-investments"),
    ("telegram", "–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram –±–æ—Ç–∞", "python-telegram-bot"),
    ("loguru", "–î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è", "loguru"),
    ("dotenv", "–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ .env —Ñ–∞–π–ª–æ–≤", "python-dotenv"),
    ("aiohttp", "–î–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤", "aiohttp"),
    ("pandas", "–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö", "pandas"),
    ("numpy", "–î–ª—è —á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π", "numpy"),
]

print("üì¶ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ë–ò–ë–õ–ò–û–¢–ï–ö–ò:")
print("-" * 40)

all_success = True
for import_name, description, pkg_name in critical_libs:
    try:
        # –î–ª—è tinkoff.invest —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Å–æ–±—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∏–º–ø–æ—Ä—Ç—É
        if import_name == "tinkoff.invest":
            from tinkoff.invest import Client
            print(f"‚úÖ {import_name:25} - {description}")
        else:
            __import__(import_name.replace(".", "_"))
            print(f"‚úÖ {import_name:25} - {description}")
    except ImportError as e:
        print(f"‚ùå {import_name:25} - –ù–ï –ù–ê–ô–î–ï–ù. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install {pkg_name}")
        all_critical_success = False

print("\nüìä –í–ï–†–°–ò–ò –£–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–• –ë–ò–ë–õ–ò–û–¢–ï–ö:")
print("-" * 40)

try:
    import pandas as pd
    import numpy as np
    import telegram
    import grpc
    import aiohttp
    from tinkoff.invest import __version__ as tinkoff_version

    print(f"Pandas: {pd.__version__}")
    print(f"Numpy: {np.__version__}")
    print(f"Python Telegram Bot: {telegram.__version__}")
    print(f"gRPC (grpcio): {grpc.__version__}")
    print(f"AIOHTTP: {aiohttp.__version__}")
    print(f"Tinkoff Investments: {tinkoff_version}")
except ImportError as e:
    print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ—Ä—Å–∏–∏: {e}")

print("\n" + "=" * 50)

if all_success:
    print("‚úÖ –û–°–ù–û–í–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ –£–°–¢–ê–ù–û–í–õ–ï–ù–´.")
    print("   –Ø–¥—Ä–æ –±–æ—Ç–∞ (–∫–ª–∏–µ–Ω—Ç API, gRPC, —Ç–µ–ª–µ–≥—Ä–∞–º) –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ.")
else:
    print("‚ùå –ù–ï –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞–π–¥–µ–Ω—ã.")
    print("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥–æ–π:")
    print("   pip install -r requirements.txt")


================================================================================
–§–ê–ô–õ: scripts/check_structure.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/scripts/check_structure.py
================================================================================

#!/usr/bin/env python3
"""
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞
"""

import os
import sys
from pathlib import Path

# –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

def check_structure():
    print("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞...")
    print("=" * 50)
    
    # –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
    expected_dirs = [
        'src',
        'src/data_feed', 
        'src/strategies',
        'src/execution',
        'src/risk_management',
        'src/utils',
        'telegram_bot',
        'telegram_bot/handlers',
        'telegram_bot/services',
        'telegram_bot/utils',
        'tests',
        'scripts',
        'project_utils',
        'logs'
    ]
    
    # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã
    critical_files = [
        'requirements.txt',
        '.env',
        'README.md',
        'manage_bot.py',
        'bot_control.sh',
        
        # Telegram –±–æ—Ç
        'telegram_bot/bot.py',
        'telegram_bot/config.py',
        'telegram_bot/get_chat_id.py',
        
        # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
        'src/utils/logger.py',
        'src/data_feed/tinkoff_client_simple.py',
        
        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        'telegram_bot/handlers/basic.py',
        'telegram_bot/handlers/orderbook.py',
        'telegram_bot/handlers/settings.py',
        
        # –°–µ—Ä–≤–∏—Å—ã
        'telegram_bot/services/tinkoff_service.py',
        'telegram_bot/services/orderbook_service.py'
    ]
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ)
    optional_files = [
        'create_monolithic_export.py',
        'start_bot.py',
        'stop_bot.py',
        'test_bot_monitoring.sh',
        'test_stop_messages.sh',
        'scripts/tinkoff_grpc_client_fixed.py',
        'project_utils/export_project.py'
    ]
    
    missing_dirs = []
    missing_critical_files = []
    missing_optional_files = []
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫–∏
    print("\nüìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–æ–∫:")
    for dir_path in expected_dirs:
        if not os.path.exists(dir_path):
            missing_dirs.append(dir_path)
            print(f"   ‚ùå {dir_path}")
        else:
            print(f"   ‚úÖ {dir_path}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    print("\nüìÑ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:")
    for file_path in critical_files:
        if not os.path.exists(file_path):
            missing_critical_files.append(file_path)
            print(f"   ‚ùå {file_path}")
        else:
            print(f"   ‚úÖ {file_path}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
    print("\nüìÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:")
    for file_path in optional_files:
        if not os.path.exists(file_path):
            missing_optional_files.append(file_path)
            print(f"   ‚ö†Ô∏è  {file_path} (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)")
        else:
            print(f"   ‚úÖ {file_path}")
    
    # –í—ã–≤–æ–¥–∏–º –∏—Ç–æ–≥
    print("\n" + "=" * 50)
    print("üìä –ò–¢–û–ì –ü–†–û–í–ï–†–ö–ò:")
    
    if not missing_dirs and not missing_critical_files:
        print("‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –í –ü–û–†–Ø–î–ö–ï!")
        if missing_optional_files:
            print(f"   ‚ö†Ô∏è  –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç {len(missing_optional_files)} –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤")
    else:
        if missing_dirs:
            print(f"‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–∞–ø–∫–∏ ({len(missing_dirs)}):")
            for dir_path in missing_dirs:
                print(f"   - {dir_path}")
        
        if missing_critical_files:
            print(f"‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã ({len(missing_critical_files)}):")
            for file_path in missing_critical_files:
                print(f"   - {file_path}")
        
        print("\nüõ† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
        if '.env' in missing_critical_files:
            print("   - –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –∏–∑ .env.example")
        if 'requirements.txt' in missing_critical_files:
            print("   - –°–æ–∑–¥–∞–π—Ç–µ requirements.txt —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏")

if __name__ == "__main__":
    check_structure()


================================================================================
–§–ê–ô–õ: scripts/debug_imports.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/scripts/debug_imports.py
================================================================================

#!/usr/bin/env python3
"""
–û—Ç–ª–∞–¥–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ –ø—É—Ç–µ–π Python
"""

import sys
import os
from pathlib import Path

# –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ scripts/
project_root = Path(__file__).parent.parent  # –ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –Ω–∞ 2 —É—Ä–æ–≤–Ω—è –≤—ã—à–µ
sys.path.insert(0, str(project_root))

print("üîß Debug –ø—É—Ç–µ–π Python:")
print(f"–¢–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞: {os.getcwd()}")
print(f"–ü—É—Ç–∏ Python:")
for path in sys.path:
    print(f"  - {path}")

print(f"\nüìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ src/utils/:")
try:
    print(os.listdir("src/utils"))
except Exception as e:
    print(f"–û—à–∏–±–∫–∞: {e}")

print(f"\nüìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ src/data_feed/:")
try:
    print(os.listdir("src/data_feed"))
except Exception as e:
    print(f"–û—à–∏–±–∫–∞: {e}")

# –ü—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç
print(f"\nüîÑ –ü—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç...")
try:
    import importlib.util
    spec = importlib.util.spec_from_file_location("logger", "src/utils/logger.py")
    logger_module = importlib.util.module_from_spec(spec)
    spec.loader.exec_module(logger_module)
    print("‚úÖ –ü—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç logger.py - –£–°–ü–ï–•")
except Exception as e:
    print(f"‚ùå –ü—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç logger.py: {e}")


================================================================================
–§–ê–ô–õ: scripts/debug_installation.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/scripts/debug_installation.py
================================================================================

#!/usr/bin/env python3
"""
–û—Ç–ª–∞–¥–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Python –∏ –ø–∞–∫–µ—Ç–æ–≤
"""

import sys
from pathlib import Path

# –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ scripts/
project_root = Path(__file__).parent.parent  # –ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –Ω–∞ 2 —É—Ä–æ–≤–Ω—è –≤—ã—à–µ
sys.path.insert(0, str(project_root))

print("üîß –û—Ç–ª–∞–¥–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Python:")
print(f"Python –ø—É—Ç—å: {sys.executable}")
print(f"–í–µ—Ä—Å–∏—è Python: {sys.version}")

try:
    import pip
    installed_packages = [p.key for p in pip.get_installed_distributions()]
    print("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ 'tinkoff':", 
          [p for p in installed_packages if 'tinkoff' in p])
except:
    pass

# –ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏
import pkgutil
all_modules = [name for importer, name, ispkg in pkgutil.iter_modules()]
print("–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏:", [m for m in all_modules if 'tinkoff' in m or 'invest' in m])


================================================================================
–§–ê–ô–õ: scripts/tinkoff_grpc_client_fixed.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/scripts/tinkoff_grpc_client_fixed.py
================================================================================

#!/usr/bin/env python3
"""
Tinkoff gRPC –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –±–æ—Ç–æ–º)
"""

import os
import sys
from datetime import datetime
from dotenv import load_dotenv

load_dotenv()

sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', 'src'))

from utils.logger import log

try:
    from tinkoff.invest import Client
    log.info("‚úÖ Tinkoff –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã")
except ImportError as e:
    log.error(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
    sys.exit(1)

class TinkoffGrpcFastClient:
    def __init__(self, token=None):
        self.token = token or os.getenv('INVEST_TOKEN')
        if not self.token:
            log.error("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤ .env —Ñ–∞–π–ª–µ")
            raise ValueError("–¢–æ–∫–µ–Ω Tinkoff API –Ω–µ –Ω–∞–π–¥–µ–Ω")
        log.info("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è gRPC –∫–ª–∏–µ–Ω—Ç–∞ Tinkoff")

    def find_instrument_by_ticker_sync(self, ticker: str):
        """–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ —Ç–∏–∫–µ—Ä—É"""
        try:
            with Client(self.token) as client:
                found_instruments = client.instruments.find_instrument(query=ticker)
                if not found_instruments.instruments:
                    log.error(f"‚ùå –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å —Ç–∏–∫–µ—Ä–æ–º '{ticker}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                    return None

                # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å —Ç–æ—á–Ω—ã–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º —Ç–∏–∫–µ—Ä–∞
                for instrument in found_instruments.instruments:
                    if instrument.ticker == ticker:
                        if getattr(instrument, 'api_trade_available_flag', False):
                            log.info(f"‚úÖ –ù–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: {instrument.name} ({instrument.ticker}), FIGI: {instrument.figi}")
                        else:
                            log.info(f"‚ö†Ô∏è  –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç '{ticker}' –Ω–∞–π–¥–µ–Ω, –Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ —á–µ—Ä–µ–∑ API.")
                        return instrument

                log.error(f"‚ùå –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–ª—è —Ç–∏–∫–µ—Ä–∞ '{ticker}' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
                return None

        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ '{ticker}': {e}")
            import traceback
            log.error(f"–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: {traceback.format_exc()}")
            return None

    def get_orderbook_snapshot_sync(self, ticker: str, depth: int = 5):
        log.info(f"üìä –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞–∫–∞–Ω –¥–ª—è '{ticker}'...")
        instrument = self.find_instrument_by_ticker_sync(ticker)

        if not instrument:
            log.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç '{ticker}' –¥–ª—è —Å—Ç–∞–∫–∞–Ω–∞")
            return None

        try:
            start_time = datetime.now()

            with Client(self.token) as client:
                # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç API (–º–æ–∂–µ—Ç –±—ã—Ç—å GetOrderBookResponse –∏–ª–∏ OrderBook)
                response = client.market_data.get_order_book(figi=instrument.figi, depth=depth)

            response_time = (datetime.now() - start_time).total_seconds() * 1000

            result = {
                'ticker': ticker,
                'instrument': instrument,
                'response': response,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–µ—Å—å –æ—Ç–≤–µ—Ç
                'timestamp': datetime.now(),
                'response_time_ms': response_time,
                'source': 'gRPC (sync)'
            }

            log.info(f"‚úÖ –°—Ç–∞–∫–∞–Ω '{ticker}' –ø–æ–ª—É—á–µ–Ω –∑–∞ {response_time:.1f} –º—Å")
            return result

        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ '{ticker}': {e}")
            return None

    def _quotation_to_float(self, quotation):
        """–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Quotation –≤ float"""
        if hasattr(quotation, 'units') and hasattr(quotation, 'nano'):
            return quotation.units + quotation.nano / 1e9
        return float(quotation) if quotation else 0.0

    def print_spread_and_best_prices(self, orderbook):
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏ –≤—ã–≤–æ–¥–∏—Ç –ª—É—á—à–∏–µ —Ü–µ–Ω—ã –∏ —Å–ø—Ä–µ–¥"""
        try:
            best_ask = None
            best_bid = None
            
            # –õ—É—á—à–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (–ø–µ—Ä–≤–∞—è –≤ –∞—Å–∫–∞—Ö)
            if hasattr(orderbook, 'asks') and orderbook.asks:
                best_ask = self._quotation_to_float(orderbook.asks[0].price)
                print(f"üíé –õ—É—á—à–∞—è –ø—Ä–æ–¥–∞–∂–∞ (ask): {best_ask:.2f}")
            
            # –õ—É—á—à–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ (–ø–µ—Ä–≤–∞—è –≤ –±–∏–¥–∞—Ö)
            if hasattr(orderbook, 'bids') and orderbook.bids:
                best_bid = self._quotation_to_float(orderbook.bids[0].price)
                print(f"üíé –õ—É—á—à–∞—è –ø–æ–∫—É–ø–∫–∞ (bid): {best_bid:.2f}")
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–ø—Ä–µ–¥
            if best_ask is not None and best_bid is not None:
                spread = best_ask - best_bid
                print(f"üìè Spread: {spread:.2f}")
            else:
                print("üìè Spread: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö")
                
        except Exception as e:
            print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å–ø—Ä–µ–¥–∞: {e}")

    def print_pretty_orderbook(self, data):
        """
        –ö—Ä–∞—Å–∏–≤–æ –ø–µ—á–∞—Ç–∞–µ—Ç —Å—Ç–∞–∫–∞–Ω (—Å –ª—É—á—à–∏–º–∏ —Ü–µ–Ω–∞–º–∏ –∏ —Å–ø—Ä–µ–¥–æ–º)
        """
        if not data:
            print(f"‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–∫–∞–Ω–∞")
            return

        response = data['response']
        instrument = data['instrument']

        # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–±—ä–µ–∫—Ç —Å—Ç–∞–∫–∞–Ω–∞ –∏–∑ –æ—Ç–≤–µ—Ç–∞ (–∫–∞–∫ –≤ –±–æ—Ç–µ)
        orderbook = response.orderbook if hasattr(response, 'orderbook') else response

        print(f"\n{'='*60}")
        print(f"üìä –°–¢–ê–ö–ê–ù {data['ticker']} ({instrument.name})")
        print(f"‚è∞ {data['timestamp'].strftime('%H:%M:%S')} | üì° {data['source']}")
        print(f"‚ö° –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {data.get('response_time_ms', 0):.1f} –º—Å")
        print(f"{'='*60}")

        # –ê—Å–∫–∏ (–ø—Ä–æ–¥–∞–∂–∞) - —Å–≤–µ—Ä—Ö—É
        if hasattr(orderbook, 'asks') and orderbook.asks:
            print("üí∞ –ü–†–û–î–ê–ñ–ê (asks):")
            for ask in orderbook.asks[:5]:
                price = self._quotation_to_float(ask.price)
                quantity = ask.quantity
                print(f"  {price:10.2f} | {quantity:6} –ª–æ—Ç–æ–≤")
        else:
            print("üí∞ –ü–†–û–î–ê–ñ–ê: –ø—É—Å—Ç–æ")

        print(f"{'-'*30}")

        # –ë–∏–¥—ã (–ø–æ–∫—É–ø–∫–∞) - —Å–Ω–∏–∑—É
        if hasattr(orderbook, 'bids') and orderbook.bids:
            print("üõí –ü–û–ö–£–ü–ö–ê (bids):")
            for bid in orderbook.bids[:5]:
                price = self._quotation_to_float(bid.price)
                quantity = bid.quantity
                print(f"  {price:10.2f} | {quantity:6} –ª–æ—Ç–æ–≤")
        else:
            print("üõí –ü–û–ö–£–ü–ö–ê: –ø—É—Å—Ç–æ")

        print(f"{'='*60}")
        # –í—ã–≤–æ–¥–∏–º –ª—É—á—à–∏–µ —Ü–µ–Ω—ã –∏ —Å–ø—Ä–µ–¥
        self.print_spread_and_best_prices(orderbook)
        print(f"{'='*60}")

# –°–ò–ù–•–†–û–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–û–ú–ê–ù–î–ù–û–ô –°–¢–†–û–ö–ò
# ==========================================

def get_orderbook_sync(ticker="SBER", depth=5):
    """–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞"""
    client = TinkoffGrpcFastClient()
    data = client.get_orderbook_snapshot_sync(ticker, depth)
    if data:
        client.print_pretty_orderbook(data)
    else:
        print(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω {ticker}")

def test_connection_sync(ticker="SBER"):
    """–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"""
    print(f"üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Tinkoff –¥–ª—è —Ç–∏–∫–µ—Ä–∞ '{ticker}'...")
    try:
        client = TinkoffGrpcFastClient()
        instrument = client.find_instrument_by_ticker_sync(ticker)
        if instrument:
            print(f"‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω!")
            print(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {instrument.name}")
            print(f"   –¢–∏–∫–µ—Ä: {instrument.ticker}")
            print(f"   FIGI: {instrument.figi}")
            if hasattr(instrument, 'lot'):
                print(f"   –õ–æ—Ç: {instrument.lot}")
            return True
        else:
            print(f"‚ùå –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç '{ticker}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return False
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return False

# –¢–û–ß–ö–ê –í–•–û–î–ê
# ===========

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    if len(sys.argv) < 2:
        print("""
üì° Tinkoff gRPC Client - –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
  python scripts/tinkoff_grpc_client_fixed.py <–∫–æ–º–∞–Ω–¥–∞> [—Ç–∏–∫–µ—Ä] [–≥–ª—É–±–∏–Ω–∞]

–ö–æ–º–∞–Ω–¥—ã:
  test [—Ç–∏–∫–µ—Ä]       - –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –ø–æ–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
  get [—Ç–∏–∫–µ—Ä] [–≥–ª—É–±] - –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω (–≥–ª—É–±–∏–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—è: 5)

–ü—Ä–∏–º–µ—Ä—ã:
  python scripts/tinkoff_grpc_client_fixed.py test SBER
  python scripts/tinkoff_grpc_client_fixed.py get DOMRF 10
        """)
        return

    command = sys.argv[1].lower()

    if command == "test":
        ticker = sys.argv[2] if len(sys.argv) > 2 else "SBER"
        test_connection_sync(ticker)

    elif command == "get":
        ticker = sys.argv[2] if len(sys.argv) > 2 else "SBER"
        depth = int(sys.argv[3]) if len(sys.argv) > 3 else 5
        get_orderbook_sync(ticker, depth)

    else:
        print(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: {command}")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: scripts/tinkoff_scanner.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/scripts/tinkoff_scanner.py
================================================================================

#!/usr/bin/env python3
"""
–°–∫—Ä–∏–Ω–µ—Ä —Å—Ç–∞–∫–∞–Ω–æ–≤ –Ω–∞ Tinkoff API (–±–æ–µ–≤–æ–π –∫–æ–Ω—Ç—É—Ä)
"""

import sys
import os
import time
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# –î–æ–±–∞–≤–ª—è–µ–º src –≤ –ø—É—Ç—å Python
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', 'src'))

from data_feed.tinkoff_client_simple import TinkoffAPIClientSimple
from utils.logger import log

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∫—Ä–∏–Ω–µ—Ä–∞"""
    log.info("üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–Ω–µ—Ä –Ω–∞ Tinkoff API (–ë–û–ï–í–û–ô –ö–û–ù–¢–£–†)...")
    
    try:
        client = TinkoffAPIClientSimple()
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        test_data = client.get_orderbook("SBER")
        if test_data:
            log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Tinkoff API —Ä–∞–±–æ—Ç–∞–µ—Ç")
        else:
            log.error("‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Tinkoff API")
            return
    
    except Exception as e:
        log.error(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: {e}")
        return
    
    # –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ä–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    tickers = ["ABIO"]
    
    try:
        while True:
            # –û—á–∏—â–∞–µ–º –∫–æ–Ω—Å–æ–ª—å
            os.system('clear' if os.name == 'posix' else 'cls')
            
            print("üéØ –°–ö–†–ò–ù–ï–† –°–¢–ê–ö–ê–ù–û–í - TINKOFF API (–ë–û–ï–í–û–ô –ö–û–ù–¢–£–†)")
            print("–î–ê–ù–ù–´–ï –†–ï–ê–õ–¨–ù–´–ï - –ë–£–î–¨–¢–ï –û–°–¢–û–†–û–ñ–ù–´!")
            print("–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C\n")
            
            for ticker in tickers:
                client.print_pretty_orderbook(ticker, depth=3)
                print()
            
            print("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥...")
            time.sleep(1)
            
    except KeyboardInterrupt:
        log.info("‚èπÔ∏è  –°–∫—Ä–∏–Ω–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        log.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Å–∫—Ä–∏–Ω–µ—Ä–µ: {e}")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: src/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: src/data_feed/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/data_feed/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: src/data_feed/moex_client.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/data_feed/moex_client.py
================================================================================

import requests
import pandas as pd
from src.utils.logger import log

class MOEXClient:
    """
    –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏
    """
    
    def __init__(self):
        self.base_url = "https://iss.moex.com/iss"
        self.session = requests.Session()
        log.info("MOEX –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    
    def get_security_info(self, ticker: str) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±—É–º–∞–≥–µ"""
        url = f"{self.base_url}/securities/{ticker}.json"
        try:
            response = self.session.get(url)
            response.raise_for_status()
            data = response.json()
            log.info(f"–î–∞–Ω–Ω—ã–µ –ø–æ {ticker} –ø–æ–ª—É—á–µ–Ω—ã")
            return data
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ {ticker}: {e}")
            return {}
    
    def get_current_market_data(self, ticker: str) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"""
        url = f"{self.base_url}/engines/stock/markets/shares/boards/TQBR/securities/{ticker}.json"
        try:
            response = self.session.get(url)
            data = response.json()
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            market_data = data.get('marketdata', {}).get('data', [])
            if market_data:
                # –ë–∞–∑–æ–≤—ã–µ –ø–æ–ª—è –∏–∑ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                last_trade = market_data[0]
                return {
                    'last_price': last_trade[12],  # LAST
                    'change': last_trade[13],      # CHANGE
                    'volume': last_trade[9]        # VOLUME
                }
            return {}
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö {ticker}: {e}")
            return {}

if __name__ == "__main__":
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç
    client = MOEXClient()
    
    # –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ SBER
    sber_info = client.get_security_info("SBER")
    if sber_info:
        log.info("‚úÖ MOEX –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç - –¥–∞–Ω–Ω—ã–µ SBER –ø–æ–ª—É—á–µ–Ω—ã")
    
    sber_market = client.get_current_market_data("SBER")
    if sber_market:
        log.info(f"‚úÖ –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ SBER: {sber_market}")


================================================================================
–§–ê–ô–õ: src/data_feed/orderbook.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/data_feed/orderbook.py
================================================================================

import requests
import pandas as pd
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ utils
current_dir = os.path.dirname(os.path.abspath(__file__))
src_root = os.path.dirname(current_dir)
sys.path.insert(0, src_root)

from utils.logger import log

class MOEXOrderbook:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ –∑–∞—è–≤–æ–∫ —Å MOEX"""
    
    def __init__(self):
        self.base_url = "https://iss.moex.com/iss"
        self.session = requests.Session()
        log.info("MOEX Orderbook –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    
    def get_orderbook(self, ticker: str) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –∑–∞—è–≤–æ–∫ –ø–æ —Ç–∏–∫–µ—Ä—É"""
        url = f"{self.base_url}/engines/stock/markets/shares/securities/{ticker}/orderbook.json"
        
        try:
            response = self.session.get(url)
            response.raise_for_status()
            data = response.json()
            
            # –ü–∞—Ä—Å–∏–º —Å—Ç–∞–∫–∞–Ω
            orderbook_data = self._parse_orderbook(data)
            log.info(f"–°—Ç–∞–∫–∞–Ω –ø–æ {ticker} –ø–æ–ª—É—á–µ–Ω")
            return orderbook_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ {ticker}: {e}")
            log.error(f"URL –±—ã–ª: {url}")
            return {}
    
    def _parse_orderbook(self, data: dict) -> dict:
        """–ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–∫–∞–Ω–∞"""
        result = {}
        
        # –ü–∞—Ä—Å–∏–º –ø–æ–∫—É–ø–∫–∏ (bids)
        if 'orderbook' in data and 'bids' in data['orderbook']:
            bids_data = data['orderbook']['bids']
            if bids_data:
                result['bids'] = pd.DataFrame(bids_data)
        
        # –ü–∞—Ä—Å–∏–º –ø—Ä–æ–¥–∞–∂–∏ (asks)  
        if 'orderbook' in data and 'asks' in data['orderbook']:
            asks_data = data['orderbook']['asks']
            if asks_data:
                result['asks'] = pd.DataFrame(asks_data)
        
        return result
    
    def print_pretty_orderbook(self, ticker: str, levels: int = 5):
        """–ö—Ä–∞—Å–∏–≤–æ –≤—ã–≤–æ–¥–∏–º —Å—Ç–∞–∫–∞–Ω"""
        orderbook = self.get_orderbook(ticker)
        
        if not orderbook or ('bids' not in orderbook and 'asks' not in orderbook):
            print(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –¥–ª—è {ticker}")
            print("‚ÑπÔ∏è  –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
            print("   - –¢–æ—Ä–≥–∏ –ø–æ —ç—Ç–æ–π –±—É–º–∞–≥–µ –Ω–µ –∏–¥—É—Ç")
            print("   - –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ MOEX")
            print("   - –¢–∏–∫–µ—Ä —É–∫–∞–∑–∞–Ω –Ω–µ–≤–µ—Ä–Ω–æ")
            return
        
        print(f"\nüìä –°—Ç–∞–∫–∞–Ω –ø–æ {ticker}:")
        print("=" * 50)
        
        # –í—ã–≤–æ–¥–∏–º –ø—Ä–æ–¥–∞–∂–∏ (asks) - —Å–≤–µ—Ä—Ö—É
        if 'asks' in orderbook and not orderbook['asks'].empty:
            print("üí∞ –ü–†–û–î–ê–ñ–ò (asks):")
            asks_df = orderbook['asks'].head(levels)
            for _, row in asks_df.iterrows():
                price = row[0]  # –¶–µ–Ω–∞
                quantity = row[1]  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
                print(f"   {price:8.2f} | {quantity:6} –ª–æ—Ç–æ–≤")
        
        print("-" * 30)
        
        # –í—ã–≤–æ–¥–∏–º –ø–æ–∫—É–ø–∫–∏ (bids) - —Å–Ω–∏–∑—É
        if 'bids' in orderbook and not orderbook['bids'].empty:
            print("üõí –ü–û–ö–£–ü–ö–ò (bids):")
            bids_df = orderbook['bids'].head(levels)
            for _, row in bids_df.iterrows():
                price = row[0]  # –¶–µ–Ω–∞
                quantity = row[1]  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
                print(f"   {price:8.2f} | {quantity:6} –ª–æ—Ç–æ–≤")
        
        print("=" * 50)

if __name__ == "__main__":
    client = MOEXOrderbook()
    client.print_pretty_orderbook("SBER")


================================================================================
–§–ê–ô–õ: src/data_feed/tinkoff_client_simple.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/data_feed/tinkoff_client_simple.py
================================================================================

import os
import sys
from datetime import datetime
from dotenv import load_dotenv

load_dotenv()

current_dir = os.path.dirname(os.path.abspath(__file__))
src_root = os.path.dirname(current_dir)
sys.path.insert(0, src_root)

from tinkoff.invest import Client
from utils.logger import log

class TinkoffAPIClientSimple:
    def __init__(self):
        self.token = os.getenv('INVEST_TOKEN')
        if not self.token:
            log.error("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
            raise ValueError("–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω")
        log.info("Tinkoff API –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (–ë–û–ï–í–û–ô –ö–û–ù–¢–£–†)")
    
    def find_instrument_by_ticker(self, ticker):
        with Client(self.token) as client:
            instruments = client.instruments.find_instrument(query=ticker)
            for instrument in instruments.instruments:
                if instrument.ticker == ticker:
                    log.info(f"–ù–∞–π–¥–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: {instrument.name} ({instrument.ticker}), FIGI: {instrument.figi}")
                    # –£–ë–ò–†–ê–ï–ú –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
                    return instrument
            log.error(f"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å —Ç–∏–∫–µ—Ä–æ–º {ticker} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return None
    
    def get_orderbook(self, ticker: str, depth: int = 5):
        instrument = self.find_instrument_by_ticker(ticker)
        if not instrument:
            return None
            
        try:
            with Client(self.token) as client:
                log.info(f"–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞–∫–∞–Ω –¥–ª—è FIGI: {instrument.figi}, –≥–ª—É–±–∏–Ω–∞: {depth}")
                orderbook = client.market_data.get_order_book(figi=instrument.figi, depth=depth)
                
                # –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å—Ç–∞–∫–∞–Ω–∞
                log.info(f"–°—Ç–∞–∫–∞–Ω –ø–æ–ª—É—á–µ–Ω: {orderbook}")
                log.info(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ bids: {len(orderbook.bids)}")
                log.info(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ asks: {len(orderbook.asks)}")
                
                return {
                    'ticker': ticker,
                    'instrument': instrument,
                    'orderbook': orderbook,
                    'timestamp': datetime.now()
                }
                
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ {ticker}: {e}")
            return None
    
    def print_pretty_orderbook(self, ticker: str, depth: int = 5):
        data = self.get_orderbook(ticker, depth)
        
        if not data:
            print(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –¥–ª—è {ticker}")
            return
        
        orderbook = data['orderbook']
        instrument = data['instrument']
        
        print(f"\nüìä –°—Ç–∞–∫–∞–Ω –ø–æ {ticker} ({instrument.name}):")
        print("=" * 60)
        
        if orderbook.asks:
            print("üí∞ –ü–†–û–î–ê–ñ–ò (asks):")
            for ask in orderbook.asks:
                price = self.quotation_to_float(ask.price)
                quantity = ask.quantity
                print(f"   {price:10.2f} | {quantity:6} –ª–æ—Ç–æ–≤")
        else:
            print("üí∞ –ü–†–û–î–ê–ñ–ò (asks): –ø—É—Å—Ç–æ")
        
        print("-" * 30)
        
        if orderbook.bids:
            print("üõí –ü–û–ö–£–ü–ö–ò (bids):")
            for bid in orderbook.bids:
                price = self.quotation_to_float(bid.price)
                quantity = bid.quantity
                print(f"   {price:10.2f} | {quantity:6} –ª–æ—Ç–æ–≤")
        else:
            print("üõí –ü–û–ö–£–ü–ö–ò (bids): –ø—É—Å—Ç–æ")
        
        print("=" * 60)
        if hasattr(orderbook, 'best_bid_price') and orderbook.best_bid_price:
            print(f"üíé –õ—É—á—à–∏–π —Å–ø—Ä–æ—Å: {self.quotation_to_float(orderbook.best_bid_price):.2f}")
        else:
            print(f"üíé –õ—É—á—à–∏–π —Å–ø—Ä–æ—Å: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö")
            
        if hasattr(orderbook, 'best_ask_price') and orderbook.best_ask_price:
            print(f"üíé –õ—É—á—à–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: {self.quotation_to_float(orderbook.best_ask_price):.2f}")
        else:
            print(f"üíé –õ—É—á—à–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö")
            
        print(f"‚è∞ –í—Ä–µ–º—è: {data['timestamp'].strftime('%H:%M:%S')}")
    
    def quotation_to_float(self, quotation):
        if hasattr(quotation, 'units') and hasattr(quotation, 'nano'):
            return quotation.units + quotation.nano / 1e9
        return float(quotation) if quotation else 0.0

if __name__ == "__main__":
    client = TinkoffAPIClientSimple()
    client.print_pretty_orderbook("SBER")


================================================================================
–§–ê–ô–õ: src/execution/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/execution/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: src/risk_management/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/risk_management/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: src/strategies/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/strategies/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: src/utils/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/utils/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: src/utils/logger.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/src/utils/logger.py
================================================================================

"""
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ –≤–∏–¥–∞ –ª–æ–≥–æ–≤: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏
"""

from loguru import logger
import sys
import os
from datetime import datetime
from pathlib import Path

class TradingLogger:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞–º–∏ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞"""
    
    def __init__(self):
        self.logs_dir = Path("logs")
        self.setup_directories()
        self.setup_loggers()
    
    def setup_directories(self):
        """–°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –¥–ª—è –ª–æ–≥–æ–≤"""
        # –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–ø–∫–∞ –ª–æ–≥–æ–≤
        self.logs_dir.mkdir(exist_ok=True)
        
        # –ü–æ–¥–ø–∞–ø–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ª–æ–≥–æ–≤
        (self.logs_dir / "technical").mkdir(exist_ok=True)
        (self.logs_dir / "business").mkdir(exist_ok=True)
        (self.logs_dir / "errors").mkdir(exist_ok=True)
    
    def setup_loggers(self):
        """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å–µ –ª–æ–≥–≥–µ—Ä—ã"""
        
        # –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        logger.remove()
        
        # 1. –ö–û–ù–°–û–õ–¨–ù–´–ô –õ–û–ì–ì–ï–† (—Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
        logger.add(
            sys.stdout,
            format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | "
                   "<level>{level: <8}</level> | "
                   "<cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> | "
                   "<level>{message}</level>",
            level="INFO",
            colorize=True,
            filter=lambda record: record["level"].name in ["INFO", "WARNING", "ERROR", "CRITICAL"]
        )
        
        # 2. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –õ–û–ì–ò (–≤—Å–µ DEBUG —Å–æ–æ–±—â–µ–Ω–∏—è)
        logger.add(
            self.logs_dir / "technical" / "technical_{time:YYYY-MM-DD}.log",
            rotation="00:00",  # –ù–æ–≤–∞—è —Ñ–∞–π–ª –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
            retention="30 days",  # –•—Ä–∞–Ω–∏–º 30 –¥–Ω–µ–π
            compression="zip",  # –°–∂–∏–º–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
            format="{time:YYYY-MM-DD HH:mm:ss.SSS} | "
                   "{level: <8} | "
                   "{name}:{function}:{line} | "
                   "{message}",
            level="DEBUG",
            encoding="utf-8"
        )
        
        # 3. –ë–ò–ó–ù–ï–°-–õ–û–ì–ò (–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–∏—Å—Ç–µ–º—ã)
        logger.add(
            self.logs_dir / "business" / "business_{time:YYYY-MM-DD}.log",
            rotation="00:00",
            retention="90 days",  # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏ —Ö—Ä–∞–Ω–∏–º –¥–æ–ª—å—à–µ
            format="{time:YYYY-MM-DD HH:mm:ss} | "
                   "{extra[component]: <15} | "
                   "{extra[action]: <20} | "
                   "{extra[user_id]: <15} | "
                   "{message}",
            level="INFO",
            encoding="utf-8"
        )
        
        # 4. –õ–û–ì–ò –û–®–ò–ë–û–ö (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫)
        logger.add(
            self.logs_dir / "errors" / "errors_{time:YYYY-MM-DD}.log",
            rotation="10 MB",
            retention="60 days",
            format="{time:YYYY-MM-DD HH:mm:ss.SSS} | "
                   "{level: <8} | "
                   "{name}:{function}:{line} | "
                   "{message}\n"
                   "Traceback: {exception}",
            level="ERROR",
            encoding="utf-8"
        )
        
        # 5. –û–ë–©–ò–ô –õ–û–ì (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º)
        logger.add(
            self.logs_dir / "trading_bot.log",
            rotation="10 MB",
            retention="10 days",
            level="INFO",
            encoding="utf-8"
        )
    
    def business_log(self, component: str, action: str, user_id: str = "system", **kwargs):
        """–ó–∞–ø–∏—Å—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∞
        
        Args:
            component: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã (bot, api, monitoring)
            action: –î–µ–π—Å—Ç–≤–∏–µ (start, stop, command, error)
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ 'system'
            **kwargs: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        """
        with logger.contextualize(component=component, action=action, user_id=user_id):
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            details = " | ".join(f"{k}={v}" for k, v in kwargs.items() if v)
            message = details if details else "No details"
            logger.info(message)

# –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ª–æ–≥–≥–µ—Ä–∞
log_manager = TradingLogger()
log = logger

# –ö–æ—Ä–æ—Ç–∫–∏–µ –∞–ª–∏–∞—Å—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
def log_business(component: str, action: str, user_id: str = "system", **kwargs):
    """–ö–æ—Ä–æ—Ç–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"""
    log_manager.business_log(component, action, user_id, **kwargs)

def log_command(command: str, user_id: str, **kwargs):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    log_manager.business_log("bot", "command", user_id, command=command, **kwargs)

def log_monitoring(action: str, ticker: str, interval: int = None, **kwargs):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"""
    log_manager.business_log("monitoring", action, "system", 
                           ticker=ticker, interval=interval, **kwargs)

def log_api_call(service: str, endpoint: str, duration_ms: float = None, **kwargs):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤ API"""
    log_manager.business_log("api", "call", "system",
                           service=service, endpoint=endpoint, 
                           duration_ms=duration_ms, **kwargs)

if __name__ == "__main__":
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä
    log.info("–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ª–æ–≥: —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞")
    log.debug("–û—Ç–ª–∞–¥–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")
    log.error("–¢–µ—Å—Ç –æ—à–∏–±–∫–∏")
    
    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏
    log_business("bot", "start", "system", version="1.0")
    log_command("/orderbook", "user123", ticker="SBER")
    log_monitoring("start", "SBER", interval=30)
    log_api_call("tinkoff", "get_orderbook", duration_ms=150.5)


================================================================================
–§–ê–ô–õ: telegram_bot/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: telegram_bot/bot.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/bot.py
================================================================================

#!/usr/bin/env python3
"""
–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å Telegram –±–æ—Ç–∞
–ó–∞–ø—É—Å–∫: python telegram_bot/bot.py
"""

import os
import sys
import asyncio
import signal
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø—É—Ç—å Python
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from dotenv import load_dotenv
from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
from telegram_bot.handlers.basic import start, help_command, status
from telegram_bot.handlers.settings import set_ticker, set_depth, set_interval
from telegram_bot.handlers.orderbook import get_orderbook, start_monitoring, stop_monitoring
from telegram_bot.config import bot_state, TELEGRAM_CHAT_ID, send_notification
from src.utils.logger import log, log_business, log_command

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')

# –§–ª–∞–≥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π
shutdown_event = asyncio.Event()

async def send_startup_message(bot):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞"""
    if TELEGRAM_CHAT_ID and TELEGRAM_CHAT_ID != '–≤–∞—à_chat_id_—Å—é–¥–∞':
        message = "ü§ñ <b>–ë–æ—Ç –ø—Ä–æ—Å–Ω—É–ª—Å—è!</b>\n\n–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start"
        await send_notification(bot, message)
        log.info("–°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–ø—É—Å–∫–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ")
        log_business("bot", "startup", "system")

async def send_shutdown_message(bot):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞"""
    if TELEGRAM_CHAT_ID and TELEGRAM_CHAT_ID != '–≤–∞—à_chat_id_—Å—é–¥–∞':
        message = "üò¥ <b>–ë–æ—Ç —É—à—ë–ª —Å–ø–∞—Ç—å</b>\n\n–î–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞"
        await send_notification(bot, message)
        log.info("–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ")
        log_business("bot", "shutdown", "system")

def signal_handler(signum, frame):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è"""
    log.warning(f"–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è {signum}")
    shutdown_event.set()

def create_application():
    """–°–æ–∑–¥–∞—ë—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞"""
    # –°–æ–∑–¥–∞—ë–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å JobQueue
    app = Application.builder().token(TELEGRAM_BOT_TOKEN).build()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("help", help_command))
    app.add_handler(CommandHandler("status", status))
    
    app.add_handler(CommandHandler("ticker", set_ticker))
    app.add_handler(CommandHandler("depth", set_depth))
    app.add_handler(CommandHandler("interval", set_interval))
    
    app.add_handler(CommandHandler("orderbook", get_orderbook))
    app.add_handler(CommandHandler("start_monitoring", start_monitoring))
    app.add_handler(CommandHandler("stop_monitoring", stop_monitoring))
    
    return app

async def main_async():
    """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    log.info("ü§ñ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    log_business("bot", "start", "system")
    
    if not TELEGRAM_BOT_TOKEN or "–≤–∞—à_—Ç–æ–∫–µ–Ω" in TELEGRAM_BOT_TOKEN:
        log.error("–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!")
        return
    
    if not TELEGRAM_CHAT_ID or "–≤–∞—à_chat_id" in TELEGRAM_CHAT_ID:
        log.warning("Chat ID –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!")
    
    try:
        # –°–æ–∑–¥–∞—ë–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        application = create_application()
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º JobQueue –≤—Ä—É—á–Ω—É—é
        await application.initialize()
        await application.start()
        await application.updater.start_polling()
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä–∞–±–æ—Ç—ã
        bot_state['is_running'] = True
        
        log.info("–ë–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        log.info("JobQueue –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–ø—É—Å–∫–µ
        await send_startup_message(application.bot)
        
        log.info("üì° –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç... (Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏)")
        
        # –ñ–¥–µ–º —Å–∏–≥–Ω–∞–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        await shutdown_event.wait()
        
        log.info("–ó–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É...")
        
        # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞
        await application.updater.stop()
        await application.stop()
        
        log.info("üëã –ë–æ—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É")
        
    except KeyboardInterrupt:
        log.warning("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
        if 'application' in locals():
            await send_shutdown_message(application.bot)
            await application.updater.stop()
            await application.stop()
    except Exception as e:
        log.error(f"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")
    finally:
        bot_state['is_running'] = False
        log_business("bot", "stop", "system")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
    signal.signal(signal.SIGINT, signal_handler)
    signal.signal(signal.SIGTERM, signal_handler)
    
    try:
        # –ó–∞–ø—É—Å–∫–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
        asyncio.run(main_async())
    except KeyboardInterrupt:
        log.info("–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...")
    except Exception as e:
        log.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: telegram_bot/config.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/config.py
================================================================================

#!/usr/bin/env python3
"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞
"""

import os
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ –∏–∑ .env
TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN', '–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_—Å—é–¥–∞')
TELEGRAM_CHAT_ID = os.getenv('TELEGRAM_CHAT_ID', '–≤–∞—à_chat_id_—Å—é–¥–∞')

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Tinkoff –∏–∑ .env
INVEST_TOKEN = os.getenv('INVEST_TOKEN', '–≤–∞—à_—Ç–æ–∫–µ–Ω_—Å—é–¥–∞')
SANDBOX = os.getenv('SANDBOX', 'true').lower() == 'true'

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞ (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏)
bot_state = {
    'ticker': os.getenv('DEFAULT_TICKER', 'SBER'),
    'depth': int(os.getenv('DEFAULT_DEPTH', 5)),
    'interval': int(os.getenv('DEFAULT_INTERVAL', 10)),
    'monitoring_job': None,  # –ó–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    'job_queue': None,       # JobQueue –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á
    'is_running': False      # –§–ª–∞–≥ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
}

async def send_notification(bot, message: str):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —á–∞—Ç"""
    if TELEGRAM_CHAT_ID and TELEGRAM_CHAT_ID != '–≤–∞—à_chat_id_—Å—é–¥–∞':
        try:
            await bot.send_message(
                chat_id=TELEGRAM_CHAT_ID,
                text=message,
                parse_mode='HTML'
            )
            return True
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}")
            return False
    return False


================================================================================
–§–ê–ô–õ: telegram_bot/get_chat_id.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/get_chat_id.py
================================================================================

#!/usr/bin/env python3
"""
–ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID –¥–ª—è Telegram –±–æ—Ç–∞
–ó–∞–ø—É—Å–∫: python telegram_bot/get_chat_id.py
"""

import os
import sys
import asyncio
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø—É—Ç—å Python
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from dotenv import load_dotenv
from telegram import Bot
from telegram.error import TelegramError

async def get_chat_id():
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
    load_dotenv()
    
    token = os.getenv('TELEGRAM_BOT_TOKEN')
    
    if not token:
        print("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
        print("   –î–æ–±–∞–≤—å—Ç–µ TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω –≤ .env")
        return False
    
    if "–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_—Å—é–¥–∞" in token or "your_bot_token_here" in token:
        print("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –∏–∑–º–µ–Ω–µ–Ω!")
        print("   –ó–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ TELEGRAM_BOT_TOKEN –≤ .env –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω")
        return False
    
    print("üîç –ü–û–õ–£–ß–ï–ù–ò–ï TELEGRAM CHAT ID")
    
    try:
        bot = Bot(token=token)
        print("üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–æ—Ç—É...")
        bot_info = await bot.get_me()
        print(f"‚úÖ –ë–æ—Ç: @{bot_info.username}")
        
        print("üì© –ò—â–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è...")
        updates = await bot.get_updates(timeout=10, limit=10)
        
        if not updates:
            print("‚ùå –°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!")
            print("üì± –ß—Ç–æ –¥–µ–ª–∞—Ç—å:")
            print("   1. –û—Ç–∫—Ä–æ–π—Ç–µ –¢–µ–ª–µ–≥—Ä–∞–º")
            print(f"   2. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞: @{bot_info.username}")
            print("   3. –ù–∞–∂–º–∏—Ç–µ START –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")
            print("   4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞")
            return False
        
        print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {len(updates)}")
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Ç
        last_update = updates[-1]
        if last_update.message:
            chat_id = last_update.message.chat.id
        elif last_update.callback_query:
            chat_id = last_update.callback_query.message.chat.id
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å chat_id")
            return False
        
        print(f"üéØ –ü–û–°–õ–ï–î–ù–ò–ô –ß–ê–¢ ID: {chat_id}")
        
        # –û–±–Ω–æ–≤–ª—è–µ–º .env —Ñ–∞–π–ª
        env_path = project_root / ".env"
        if env_path.exists():
            with open(env_path, "r") as f:
                lines = f.readlines()
            
            updated = False
            for i, line in enumerate(lines):
                if line.strip().startswith("TELEGRAM_CHAT_ID="):
                    lines[i] = f"TELEGRAM_CHAT_ID={chat_id}\n"
                    updated = True
                    break
            
            if not updated:
                lines.append(f"\nTELEGRAM_CHAT_ID={chat_id}\n")
            
            with open(env_path, "w") as f:
                f.writelines(lines)
            
            print(f"‚úÖ Chat ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ .env —Ñ–∞–π–ª")
        else:
            print(f"üìù –°–æ–∑–¥–∞–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:")
            print(f"TELEGRAM_CHAT_ID={chat_id}")
        
        return True
        
    except TelegramError as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ Telegram API: {e}")
        return False
    except Exception as e:
        print(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
        return False

def main():
    print("üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª—É—á–µ–Ω–∏—è Chat ID –¥–ª—è Telegram –±–æ—Ç–∞")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
    if sys.prefix == sys.base_prefix:
        print("‚ö†Ô∏è  –°–æ–≤–µ—Ç: –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: source trading_env/bin/activate")
    
    success = asyncio.run(get_chat_id())
    
    if success:
        print("üéâ –ì–æ—Ç–æ–≤–æ! Chat ID –ø–æ–ª—É—á–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω.")
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å Chat ID")
    
    return 0 if success else 1

if __name__ == "__main__":
    sys.exit(main())


================================================================================
–§–ê–ô–õ: telegram_bot/handlers/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/handlers/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: telegram_bot/handlers/basic.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/handlers/basic.py
================================================================================

#!/usr/bin/env python3
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
"""

from telegram import Update
from telegram.ext import ContextTypes
from telegram_bot.config import bot_state
from src.utils.logger import log_command, log_business

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user_id = str(update.effective_user.id)
    log_command("start", user_id)
    log_business("bot", "user_start", user_id, username=update.effective_user.username)
    
    welcome_text = """
ü§ñ <b>–¢–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞</b>

–Ø –ø–æ–º–æ–≥–∞—é –ø–æ–ª—É—á–∞—Ç—å —Å—Ç–∞–∫–∞–Ω –∑–∞—è–≤–æ–∫ —Å –±–∏—Ä–∂–∏ —á–µ—Ä–µ–∑ Telegram.

<b>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
/ticker [—Ç–∏–∫–µ—Ä] - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∏–∫–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: /ticker SBER)
/depth [—á–∏—Å–ª–æ] - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–ª—É–±–∏–Ω—É —Å—Ç–∞–∫–∞–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: /depth 10)
/interval [—Å–µ–∫—É–Ω–¥—ã] - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: /interval 5)

<b>–ö–æ–º–∞–Ω–¥—ã —Å—Ç–∞–∫–∞–Ω–∞:</b>
/orderbook - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞–∫–∞–Ω
/start_monitoring - –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
/stop_monitoring - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É

<b>–î—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã:</b>
/status - —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
/help - –ø–æ–º–æ—â—å

<b>–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</b>
/ticker SBER
/depth 5
/interval 10
/start_monitoring
"""
    await update.message.reply_text(welcome_text, parse_mode='HTML')

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    user_id = str(update.effective_user.id)
    log_command("help", user_id)
    
    help_text = """
üìö <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º</b>

<b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏:</b>
‚Ä¢ /ticker [—Ç–∏–∫–µ—Ä] - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∏–∫–µ—Ä –±—É–º–∞–≥–∏ (–ø—Ä–∏–º–µ—Ä: SBER, GAZP, YNDX)
‚Ä¢ /depth [—á–∏—Å–ª–æ] - –ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞ (–æ—Ç 1 –¥–æ 50)
‚Ä¢ /interval [—Å–µ–∫—É–Ω–¥—ã] - –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ (–æ—Ç 1 –¥–æ 3600)

<b>–°—Ç–∞–∫–∞–Ω:</b>
‚Ä¢ /orderbook - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞–∫–∞–Ω
‚Ä¢ /start_monitoring - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
‚Ä¢ /stop_monitoring - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É

<b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</b>
‚Ä¢ /status - –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚Ä¢ /help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

<b>–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</b>
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞: /ticker SBER ‚Üí /depth 10 ‚Üí /interval 30
2. –¢–µ—Å—Ç: /orderbook
3. –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: /start_monitoring
4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞: /stop_monitoring
"""
    await update.message.reply_text(help_text, parse_mode='HTML')

async def status(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /status"""
    user_id = str(update.effective_user.id)
    log_command("status", user_id)
    
    ticker = bot_state.get('ticker', 'SBER')
    depth = bot_state.get('depth', 5)
    interval = bot_state.get('interval', 10)
    monitoring = "‚úÖ –ó–∞–ø—É—â–µ–Ω" if bot_state.get('monitoring_job') else "‚ùå –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    
    status_text = f"""
üìä <b>–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</b>

üìà <b>–¢–∏–∫–µ—Ä:</b> {ticker}
üìè <b>–ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞:</b> {depth}
‚è∞ <b>–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏:</b> {interval} —Å–µ–∫—É–Ω–¥
üîÑ <b>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:</b> {monitoring}

<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:</b>
/orderbook - –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω —Å–µ–π—á–∞—Å
/start_monitoring - –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
/help - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
"""
    await update.message.reply_text(status_text, parse_mode='HTML')


================================================================================
–§–ê–ô–õ: telegram_bot/handlers/orderbook.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/handlers/orderbook.py
================================================================================

#!/usr/bin/env python3
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–∞–∫–∞–Ω–æ–º (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
"""

import asyncio
from telegram import Update
from telegram.ext import ContextTypes, JobQueue
from telegram_bot.config import bot_state
from telegram_bot.services.orderbook_service import get_orderbook as get_orderbook_data, format_orderbook_message

async def send_orderbook_job(context: ContextTypes.DEFAULT_TYPE):
    """–ó–∞–¥–∞—á–∞ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞–∫–∞–Ω–∞"""
    try:
        ticker = bot_state.get('ticker', 'SBER')
        depth = bot_state.get('depth', 5)
        print(f"üîÑ [–ó–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞] –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞–∫–∞–Ω {ticker}...")
        
        orderbook_data = await get_orderbook_data(ticker, depth)
        if not orderbook_data:
            print(f"‚ùå [–ó–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞] –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –¥–ª—è {ticker}")
            return
        
        message = await format_orderbook_message(orderbook_data)
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        message = f"üì° <b>–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ú–û–ù–ò–¢–û–†–ò–ù–ì</b>\n" + message
        
        await context.bot.send_message(
            chat_id=context.job.chat_id,
            text=message,
            parse_mode='HTML'
        )
        
        print(f"‚úÖ [–ó–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞] –°—Ç–∞–∫–∞–Ω {ticker} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")
        
    except Exception as e:
        print(f"‚ùå [–ó–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞] –û—à–∏–±–∫–∞: {e}")

async def get_orderbook(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /orderbook"""
    try:
        ticker = bot_state.get('ticker', 'SBER')
        depth = bot_state.get('depth', 5)
        
        await update.message.reply_text(f"üîç –ü–æ–ª—É—á–∞—é —Å—Ç–∞–∫–∞–Ω {ticker}...")
        
        orderbook_data = await get_orderbook_data(ticker, depth)
        if not orderbook_data:
            await update.message.reply_text(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –¥–ª—è {ticker}.")
            return
        
        message = await format_orderbook_message(orderbook_data)
        await update.message.reply_text(message, parse_mode='HTML')
        
    except Exception as e:
        await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞: {str(e)[:100]}")

async def start_monitoring(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start_monitoring"""
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        if bot_state.get('monitoring_job'):
            await update.message.reply_text("‚ö†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–∂–µ –∑–∞–ø—É—â–µ–Ω!")
            return
        
        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        ticker = bot_state.get('ticker', 'SBER')
        depth = bot_state.get('depth', 5)
        interval = bot_state.get('interval', 10)
        
        if interval < 1:
            await update.message.reply_text("‚ùå –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 1 —Å–µ–∫—É–Ω–¥—ã")
            return
        
        # –ü–æ–ª—É—á–∞–µ–º job_queue –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        job_queue = context.application.job_queue
        
        if job_queue is None:
            # –ï—Å–ª–∏ job_queue –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
            job_queue = JobQueue()
            job_queue.set_application(context.application)
            await job_queue.start()
        
        # –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        job = job_queue.run_repeating(
            send_orderbook_job,
            interval=interval,
            first=3,  # –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            chat_id=update.effective_chat.id,
            name=f"orderbook_monitoring_{ticker}"
        )
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–¥–∞—á—É –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±–æ—Ç–∞
        bot_state['monitoring_job'] = job
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º job_queue –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        bot_state['job_queue'] = job_queue
        
        await update.message.reply_text(
            f"‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω!\n\n"
            f"üìä <b>–¢–∏–∫–µ—Ä:</b> {ticker}\n"
            f"üìè <b>–ì–ª—É–±–∏–Ω–∞:</b> {depth}\n"
            f"‚è∞ <b>–ò–Ω—Ç–µ—Ä–≤–∞–ª:</b> {interval} —Å–µ–∫—É–Ω–¥\n\n"
            f"<i>–ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...</i>\n\n"
            f"–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: /stop_monitoring",
            parse_mode='HTML'
        )
        
        print(f"üöÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω: {ticker}, –∏–Ω—Ç–µ—Ä–≤–∞–ª {interval}—Å")
        
    except Exception as e:
        await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: {str(e)[:100]}")
        import traceback
        print(f"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: {traceback.format_exc()}")

async def stop_monitoring(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /stop_monitoring"""
    try:
        job = bot_state.get('monitoring_job')
        
        if job:
            # –£–¥–∞–ª—è–µ–º –∑–∞–¥–∞—á—É
            job.schedule_removal()
            bot_state['monitoring_job'] = None
            
            # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º job_queue –µ—Å–ª–∏ –æ–Ω–∞ –ø—É—Å—Ç–∞—è
            if bot_state.get('job_queue'):
                jobs = bot_state['job_queue'].jobs
                if not jobs:
                    await bot_state['job_queue'].stop()
                    bot_state['job_queue'] = None
            
            await update.message.reply_text("‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
            print("‚èπÔ∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        else:
            await update.message.reply_text("‚ö†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω")
            
    except Exception as e:
        await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: {str(e)[:100]}")


================================================================================
–§–ê–ô–õ: telegram_bot/handlers/settings.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/handlers/settings.py
================================================================================

#!/usr/bin/env python3
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
"""

from telegram import Update
from telegram.ext import ContextTypes
from telegram_bot.config import bot_state

async def set_ticker(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /ticker"""
    if not context.args:
        await update.message.reply_text("‚ùå –£–∫–∞–∂–∏—Ç–µ —Ç–∏–∫–µ—Ä. –ü—Ä–∏–º–µ—Ä: /ticker SBER")
        return
    
    ticker = context.args[0].upper().strip()
    
    # –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–∫–µ—Ä–∞
    if not ticker.isalpha():
        await update.message.reply_text("‚ùå –¢–∏–∫–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã")
        return
    
    if len(ticker) > 10:
        await update.message.reply_text("‚ùå –¢–∏–∫–µ—Ä —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π")
        return
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    bot_state['ticker'] = ticker
    
    await update.message.reply_text(f"‚úÖ –¢–∏–∫–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{ticker}</b>\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /orderbook –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏", parse_mode='HTML')

async def set_depth(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /depth"""
    if not context.args:
        await update.message.reply_text("‚ùå –£–∫–∞–∂–∏—Ç–µ –≥–ª—É–±–∏–Ω—É. –ü—Ä–∏–º–µ—Ä: /depth 10")
        return
    
    try:
        depth = int(context.args[0])
        
        if depth < 1 or depth > 50:
            await update.message.reply_text("‚ùå –ì–ª—É–±–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 50")
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        bot_state['depth'] = depth
        
        await update.message.reply_text(f"‚úÖ –ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: <b>{depth}</b>", parse_mode='HTML')
        
    except ValueError:
        await update.message.reply_text("‚ùå –ì–ª—É–±–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º")

async def set_interval(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /interval"""
    if not context.args:
        await update.message.reply_text("‚ùå –£–∫–∞–∂–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª. –ü—Ä–∏–º–µ—Ä: /interval 10")
        return
    
    try:
        interval = int(context.args[0])
        
        if interval < 1:
            await update.message.reply_text("‚ùå –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 1 —Å–µ–∫—É–Ω–¥—ã")
            return
        
        if interval > 3600:
            await update.message.reply_text("‚ùå –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –±–æ–ª–µ–µ 3600 —Å–µ–∫—É–Ω–¥ (1 —á–∞—Å)")
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        bot_state['interval'] = interval
        
        # –ï—Å–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ —Å –Ω–æ–≤—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
        job = bot_state.get('monitoring_job')
        if job:
            job.schedule_removal()
            bot_state['monitoring_job'] = None
            await update.message.reply_text(
                f"‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{interval}</b> —Å–µ–∫—É–Ω–¥\n\n"
                f"‚ö†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±—ã–ª –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞: /start_monitoring",
                parse_mode='HTML'
            )
        else:
            await update.message.reply_text(f"‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{interval}</b> —Å–µ–∫—É–Ω–¥", parse_mode='HTML')
        
    except ValueError:
        await update.message.reply_text("‚ùå –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º")


================================================================================
–§–ê–ô–õ: telegram_bot/services/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/services/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: telegram_bot/services/orderbook_service.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/services/orderbook_service.py
================================================================================

#!/usr/bin/env python3
"""
–°–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ —á–µ—Ä–µ–∑ Tinkoff API
"""

import asyncio
from typing import Optional, Dict, Any
from telegram_bot.services.tinkoff_service import get_tinkoff_service

async def get_orderbook(ticker: str, depth: int = 5) -> Optional[Dict[str, Any]]:
    """
    –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞–∫–∞–Ω –ø–æ —Ç–∏–∫–µ—Ä—É —á–µ—Ä–µ–∑ Tinkoff API
    
    Args:
        ticker: –¢–∏–∫–µ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'SBER')
        depth: –ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞
        
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —Å—Ç–∞–∫–∞–Ω–∞ –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
    """
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä–≤–∏—Å
        service = await get_tinkoff_service()
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞–∫–∞–Ω
        orderbook_data = await service.get_orderbook(ticker, depth)
        
        return orderbook_data
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ get_orderbook: {e}")
        return None

async def format_orderbook_message(data: Dict[str, Any]) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–∫–∞–Ω–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
    
    Args:
        data: –î–∞–Ω–Ω—ã–µ —Å—Ç–∞–∫–∞–Ω–∞
        
    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    if not data:
        return "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–∫–∞–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–∫–µ—Ä –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É."
    
    try:
        service = await get_tinkoff_service()
        return service.format_orderbook_for_telegram(data)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
        return "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–∫–∞–Ω–∞."


================================================================================
–§–ê–ô–õ: telegram_bot/services/tinkoff_service.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/services/tinkoff_service.py
================================================================================

#!/usr/bin/env python3
"""
–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Tinkoff API (–¢–û–õ–¨–ö–û –°–¢–ê–ö–ê–ù, —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
"""

import os
import asyncio
from datetime import datetime
from typing import Optional, Dict, Any, Tuple
from pathlib import Path
import sys

project_root = Path(__file__).parent.parent.parent
sys.path.insert(0, str(project_root))

from dotenv import load_dotenv
load_dotenv()

try:
    from tinkoff.invest import Client
    print("‚úÖ Tinkoff –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã")
except ImportError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Tinkoff: {e}")
    raise

class TinkoffService:
    def __init__(self):
        self.token = os.getenv('INVEST_TOKEN')
        if not self.token:
            raise ValueError("‚ùå –¢–æ–∫–µ–Ω Tinkoff API –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
        print("üöÄ TinkoffService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (–≤–µ—Ä—Å–∏—è: –¢–û–õ–¨–ö–û –°–¢–ê–ö–ê–ù)")

    async def find_instrument_by_ticker(self, ticker: str):
        return await asyncio.to_thread(self._find_instrument_by_ticker_sync, ticker)

    def _find_instrument_by_ticker_sync(self, ticker: str):
        try:
            with Client(self.token) as client:
                found_instruments = client.instruments.find_instrument(query=ticker)
                if not found_instruments.instruments:
                    print(f"‚ùå –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å —Ç–∏–∫–µ—Ä–æ–º '{ticker}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                    return None
                for instrument in found_instruments.instruments:
                    if instrument.ticker == ticker:
                        print(f"‚úÖ –ù–∞–π–¥–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: {instrument.name} ({instrument.ticker})")
                        return instrument
                print(f"‚ùå –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–ª—è —Ç–∏–∫–µ—Ä–∞ '{ticker}' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
                return None
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ '{ticker}': {e}")
            import traceback
            print(f"–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: {traceback.format_exc()}")
            return None

    async def get_orderbook(self, ticker: str, depth: int = 5) -> Optional[Dict[str, Any]]:
        return await asyncio.to_thread(self._get_orderbook_sync, ticker, depth)

    def _get_orderbook_sync(self, ticker: str, depth: int = 5) -> Optional[Dict[str, Any]]:
        """–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞ (–¢–û–õ–¨–ö–û bids –∏ asks)"""
        try:
            instrument = self._find_instrument_by_ticker_sync(ticker)
            if not instrument:
                return None
            print(f"üìä –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞–∫–∞–Ω –¥–ª—è '{ticker}' (–≥–ª—É–±–∏–Ω–∞: {depth})...")
            with Client(self.token) as client:
                api_response = client.market_data.get_order_book(figi=instrument.figi, depth=depth)
            orderbook_obj = api_response.orderbook if hasattr(api_response, 'orderbook') else api_response
            print(f"   –û—Ç–≤–µ—Ç —Ç–∏–ø–∞: {type(orderbook_obj).__name__}")
            result = {
                'ticker': ticker,
                'name': instrument.name,
                'asks': [],
                'bids': [],
                'timestamp': datetime.now(),
                'depth': depth
            }
            if hasattr(orderbook_obj, 'asks') and orderbook_obj.asks:
                for ask in orderbook_obj.asks[:depth]:
                    result['asks'].append({
                        'price': self._quotation_to_float(ask.price),
                        'quantity': ask.quantity
                    })
            if hasattr(orderbook_obj, 'bids') and orderbook_obj.bids:
                for bid in orderbook_obj.bids[:depth]:
                    result['bids'].append({
                        'price': self._quotation_to_float(bid.price),
                        'quantity': bid.quantity
                    })
            print(f"‚úÖ –î–∞–Ω–Ω—ã–µ —Å—Ç–∞–∫–∞–Ω–∞ '{ticker}' –ø–æ–ª—É—á–µ–Ω—ã")
            return result
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ '{ticker}': {e}")
            import traceback
            traceback.print_exc()
            return None

    def _quotation_to_float(self, quotation) -> float:
        if hasattr(quotation, 'units') and hasattr(quotation, 'nano'):
            return quotation.units + quotation.nano / 1e9
        return float(quotation) if quotation else 0.0

    def calculate_spread(self, data: Dict[str, Any]) -> str:
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ø—Ä–µ–¥ –º–µ–∂–¥—É –ª—É—á—à–µ–π —Ü–µ–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏ –∏ –ø–æ–∫—É–ø–∫–∏"""
        if not data.get('asks') or not data.get('bids'):
            return ""  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–ø—Ä–µ–¥–∞
        
        try:
            # –õ—É—á—à–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (—Å–∞–º–∞—è –Ω–∏–∑–∫–∞—è –≤ asks)
            best_ask = min(ask['price'] for ask in data['asks'])
            # –õ—É—á—à–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ (—Å–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è –≤ bids)
            best_bid = max(bid['price'] for bid in data['bids'])
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–ø—Ä–µ–¥
            spread = best_ask - best_bid
            
            # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—ã–≤–æ–¥
            return f"üìè <b>Spread:</b> {spread:.2f}"
        
        except (ValueError, KeyError) as e:
            return ""  # –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø—Ä–µ–¥

    def format_orderbook_for_telegram(self, data: Dict[str, Any]) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞–∫–∞–Ω –¥–ª—è Telegram (—Å –ª—É—á—à–∏–º–∏ —Ü–µ–Ω–∞–º–∏ –∏ —Å–ø—Ä–µ–¥–æ–º)"""
        if not data or (not data['asks'] and not data['bids']):
            return f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –¥–ª—è {data.get('ticker', '—Ç–∏–∫–µ—Ä–∞')} –∏–ª–∏ —Å—Ç–∞–∫–∞–Ω –ø—É—Å—Ç."
        timestamp = data['timestamp'].strftime('%H:%M:%S')
        message = f"<b>{data['ticker']} | {data['name']} | {timestamp}</b>\n"
        message += "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n"
        
        if data['asks']:
            message += "<b>SELL:</b>\n"
            # –°–û–†–¢–ò–†–£–ï–ú ASKS –û–¢ –ë–û–õ–¨–®–ï–ô –¶–ï–ù–´ –ö –ú–ï–ù–¨–®–ï–ô (–¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ —Å–Ω–∞—á–∞–ª–∞ —Å–∞–º—ã–µ –≤—ã–≥–æ–¥–Ω—ã–µ —Ü–µ–Ω—ã)
            sorted_asks = sorted(data['asks'], key=lambda x: x['price'], reverse=True)
            for ask in sorted_asks[:data['depth']]:
                message += f"{ask['price']:>8.2f} | {ask['quantity']:>5} –ª–æ—Ç–æ–≤\n"
        else:
            message += "<b>SELL:</b> –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö\n"
        
        message += "\n"
        
        if data['bids']:
            message += "<b>BUY:</b>\n"
            # BIDS –æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç –±–æ–ª—å—à–µ–π —Ü–µ–Ω—ã –∫ –º–µ–Ω—å—à–µ–π (–¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Å–Ω–∞—á–∞–ª–∞ —Å–∞–º—ã–µ –≤—ã–≥–æ–¥–Ω—ã–µ —Ü–µ–Ω—ã)
            sorted_bids = sorted(data['bids'], key=lambda x: x['price'], reverse=True)
            for bid in sorted_bids[:data['depth']]:
                message += f"{bid['price']:>8.2f} | {bid['quantity']:>5} –ª–æ—Ç–æ–≤\n"
        else:
            message += "<b>BUY:</b> –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö\n"
        
        # –†–ê–°–°–ß–ò–¢–´–í–ê–ï–ú –ò –î–û–ë–ê–í–õ–Ø–ï–ú –°–ü–†–ï–î
        spread_text = self.calculate_spread(data)
        if spread_text:
            message += "\n" + spread_text
        
        return message

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–∏—Å–∞
_tinkoff_service = None
async def get_tinkoff_service():
    global _tinkoff_service
    if _tinkoff_service is None:
        _tinkoff_service = TinkoffService()
    return _tinkoff_service
async def close_tinkoff_service():
    global _tinkoff_service
    _tinkoff_service = None
def format_orderbook_for_telegram(data: Dict[str, Any]) -> str:
    if not data:
        return "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–∫–∞–Ω–∞."
    service = TinkoffService()
    return service.format_orderbook_for_telegram(data)


================================================================================
–§–ê–ô–õ: telegram_bot/utils/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/utils/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: telegram_bot/utils/formatters.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/utils/formatters.py
================================================================================

"""
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è Telegram
"""

def format_settings_message(ticker: str, depth: int, interval: int, is_monitoring: bool) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    """
    status = "üü¢ –í–ö–õ" if is_monitoring else "üî¥ –í–´–ö–õ"
    
    message = (
        f"‚öôÔ∏è –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò:\n\n"
        f"üìà –¢–∏–∫–µ—Ä: {ticker}\n"
        f"üìä –ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞: {depth}\n"
        f"‚è± –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏: {interval} —Å–µ–∫.\n"
        f"üì° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: {status}\n"
    )
    return message


================================================================================
–§–ê–ô–õ: telegram_bot/utils/validators.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/telegram_bot/utils/validators.py
================================================================================

"""
–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
"""

def validate_ticker(ticker: str) -> bool:
    """
    –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–∫–µ—Ä–∞: —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã, –¥–ª–∏–Ω–∞ 2-10
    """
    if not ticker:
        return False
    if len(ticker) < 2 or len(ticker) > 10:
        return False
    if not ticker.isalnum():
        return False
    return True

def validate_depth(depth: int) -> bool:
    """
    –ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞: –æ—Ç 1 –¥–æ 50
    """
    return 1 <= depth <= 50

def validate_interval(interval: int) -> bool:
    """
    –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏: –æ—Ç 1 –¥–æ 3600 —Å–µ–∫—É–Ω–¥
    """
    return 1 <= interval <= 3600


================================================================================
–§–ê–ô–õ: tests/__init__.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/__init__.py
================================================================================



================================================================================
–§–ê–ô–õ: tests/final_structure_test.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/final_structure_test.py
================================================================================

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º src –≤ –ø—É—Ç—å Python
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

def test_imports():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à–∏ –º–æ–¥—É–ª–∏"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–º–ø–æ—Ä—Ç—ã...")
    
    try:
        from src.utils.logger import log
        print("‚úÖ src.utils.logger - –û–ö")
    except ImportError as e:
        print(f"‚ùå src.utils.logger: {e}")
    
    try:
        from src.data_feed.moex_client import MOEXClient
        print("‚úÖ src.data_feed.moex_client - –û–ö")
    except ImportError as e:
        print(f"‚ùå src.data_feed.moex_client: {e}")
    
    try:
        import pandas as pd
        print("‚úÖ pandas - –û–ö")
    except ImportError as e:
        print(f"‚ùå pandas: {e}")
    
    print("\nüéØ –¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–æ–≤ –∑–∞–≤–µ—Ä—à—ë–Ω")

if __name__ == "__main__":
    test_imports()


================================================================================
–§–ê–ô–õ: tests/test_basic.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_basic.py
================================================================================

# test_basic.py
import pandas as pd
import numpy as np
import requests
import ccxt

print("‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç!")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ
data = pd.DataFrame({
    'price': [100, 101, 102, 101, 103],
    'volume': [1000, 1500, 1200, 1800, 2000]
})

print("üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:")
print(data)
print(f"üìà –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: {data['price'].mean():.2f}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º requests
response = requests.get('https://httpbin.org/json')
print(f"üåê HTTP –∑–∞–ø—Ä–æ—Å: {response.status_code}")

================================================================================
–§–ê–ô–õ: tests/test_debug.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_debug.py
================================================================================

import os
from dotenv import load_dotenv
load_dotenv()

from tinkoff.invest import Client

token = os.getenv('INVEST_TOKEN')
with Client(token) as client:
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–∑–æ–≤–∞
    from tinkoff.invest.schemas import GetOrderBookRequest
    
    # –í–∞—Ä–∏–∞–Ω—Ç 1
    try:
        request = GetOrderBookRequest(figi="BBG004730N88", depth=5)
        result = client.market_data.get_order_book(request)
        print("‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1 —Å GetOrderBookRequest —Ä–∞–±–æ—Ç–∞–µ—Ç")
    except Exception as e:
        print(f"‚ùå –í–∞—Ä–∏–∞–Ω—Ç 1: {e}")
    
    # –í–∞—Ä–∏–∞–Ω—Ç 2  
    try:
        result = client.market_data.get_order_book(figi="BBG004730N88", depth=5)
        print("‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2 —Å –ø—Ä—è–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç")
    except Exception as e:
        print(f"‚ùå –í–∞—Ä–∏–∞–Ω—Ç 2: {e}")



================================================================================
–§–ê–ô–õ: tests/test_fix.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_fix.py
================================================================================

#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç—ã TinkoffService
"""

import sys
import asyncio
from pathlib import Path

# –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ tests/
project_root = Path(__file__).parent.parent  # –ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –Ω–∞ 2 —É—Ä–æ–≤–Ω—è –≤—ã—à–µ
sys.path.insert(0, str(project_root))

async def test():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞ —á–µ—Ä–µ–∑ TinkoffService"""
    from telegram_bot.services.tinkoff_service import TinkoffService
    
    svc = TinkoffService()
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞ –¥–ª—è SBER...")
    data = await svc.get_orderbook("SBER", 2)
    
    if data:
        print(f"‚úÖ –£—Å–ø–µ—Ö! –ü–æ–ª—É—á–µ–Ω–æ {len(data['bids'])} –±–∏–¥–æ–≤ –∏ {len(data['asks'])} –∞—Å–∫–æ–≤.")
        print(f"   –õ—É—á—à–∞—è –ø–æ–∫—É–ø–∫–∞: {data['best_bid']}, –õ—É—á—à–∞—è –ø—Ä–æ–¥–∞–∂–∞: {data['best_ask']}")
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤...")
    print("=" * 50)
    
    asyncio.run(test())
    
    print("\n‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: tests/test_fixed_imports.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_fixed_imports.py
================================================================================

#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–æ–≤ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
"""

import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø—É—Ç—å Python
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

print("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã...")

try:
    from telegram_bot.config import bot_state, TELEGRAM_BOT_TOKEN
    print("‚úÖ config.py")
except Exception as e:
    print(f"‚ùå config.py: {e}")

try:
    from telegram_bot.handlers.basic import start, help_command, status
    print("‚úÖ handlers.basic")
except Exception as e:
    print(f"‚ùå handlers.basic: {e}")

try:
    from telegram_bot.handlers.settings import set_ticker, set_depth, set_interval
    print("‚úÖ handlers.settings")
except Exception as e:
    print(f"‚ùå handlers.settings: {e}")

try:
    from telegram_bot.handlers.orderbook import get_orderbook, start_monitoring, stop_monitoring
    print("‚úÖ handlers.orderbook")
except Exception as e:
    print(f"‚ùå handlers.orderbook: {e}")

try:
    from telegram_bot.services.orderbook_service import get_orderbook as get_orderbook_data, format_orderbook_message
    print("‚úÖ services.orderbook_service")
except Exception as e:
    print(f"‚ùå services.orderbook_service: {e}")

try:
    from telegram_bot.services.tinkoff_service import get_tinkoff_service, format_orderbook_for_telegram
    print("‚úÖ services.tinkoff_service")
except Exception as e:
    print(f"‚ùå services.tinkoff_service: {e}")

print("\nüéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")


================================================================================
–§–ê–ô–õ: tests/test_imports.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_imports.py
================================================================================

#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–æ–≤ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –±–æ—Ç–∞
"""

import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø—É—Ç—å Python
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

print("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª–µ–π –±–æ—Ç–∞...")

try:
    from telegram_bot.config import bot_state, TELEGRAM_BOT_TOKEN
    print("‚úÖ config.py")
except Exception as e:
    print(f"‚ùå config.py: {e}")

try:
    from telegram_bot.handlers.basic import start, help_command, status
    print("‚úÖ handlers.basic")
except Exception as e:
    print(f"‚ùå handlers.basic: {e}")

try:
    from telegram_bot.handlers.settings import set_ticker, set_depth, set_interval
    print("‚úÖ handlers.settings")
except Exception as e:
    print(f"‚ùå handlers.settings: {e}")

try:
    from telegram_bot.handlers.orderbook import get_orderbook, start_monitoring, stop_monitoring
    print("‚úÖ handlers.orderbook")
except Exception as e:
    print(f"‚ùå handlers.orderbook: {e}")

try:
    from telegram_bot.services.orderbook_service import get_orderbook as get_orderbook_data
    print("‚úÖ services.orderbook_service")
except Exception as e:
    print(f"‚ùå services.orderbook_service: {e}")

print("\nüéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")


================================================================================
–§–ê–ô–õ: tests/test_instruments.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_instruments.py
================================================================================

#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
"""

import os
import sys
from dotenv import load_dotenv

# –î–æ–±–∞–≤–ª—è–µ–º src –≤ –ø—É—Ç—å Python
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

load_dotenv()

def main():
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤...")
    
    token = os.getenv('INVEST_TOKEN')
    if not token:
        print("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    try:
        from tinkoff.invest import Client
        from tinkoff.invest.schemas import InstrumentStatus
        
        with Client(token) as client:
            # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ SBER
            instruments = client.instruments.find_instrument(query="SBER")
            print(f"üîç –ù–∞–π–¥–µ–Ω–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–æ SBER: {len(instruments.instruments)}")
            
            for i, instrument in enumerate(instruments.instruments[:3]):  # –ü–æ–∫–∞–∂–µ–º –ø–µ—Ä–≤—ã–µ 3
                print(f"\n–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç {i+1}:")
                print(f"  –¢–∏–∫–µ—Ä: {instrument.ticker}")
                print(f"  –ù–∞–∑–≤–∞–Ω–∏–µ: {instrument.name}")
                print(f"  FIGI: {instrument.figi}")
                print(f"  State: {instrument.state}")
                print(f"  Status: {InstrumentStatus(instrument.state).name}")
                
                # –ü–æ–∫–∞–∂–µ–º –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –æ–±—ä–µ–∫—Ç–∞
                print(f"  –í—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã: {[attr for attr in dir(instrument) if not attr.startswith('_')]}")
                
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: tests/test_monitoring.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_monitoring.py
================================================================================

#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞–∫–∞–Ω–∞
"""

import sys
import os
from pathlib import Path
import asyncio

# –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ tests/
project_root = Path(__file__).parent.parent  # –ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –Ω–∞ 2 —É—Ä–æ–≤–Ω—è –≤—ã—à–µ
sys.path.insert(0, str(project_root))

async def test_monitoring():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞...")
    
    try:
        from telegram_bot.services.tinkoff_service import TinkoffService
        service = TinkoffService()
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞
        ticker = "SBER"
        depth = 5
        
        print(f"üîç –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞–∫–∞–Ω –¥–ª—è {ticker}...")
        data = await service.get_orderbook(ticker, depth)
        
        if data:
            print(f"‚úÖ –°—Ç–∞–∫–∞–Ω –ø–æ–ª—É—á–µ–Ω!")
            print(f"   –¢–∏–∫–µ—Ä: {data['ticker']}")
            print(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {data['name']}")
            print(f"   –ê—Å–∫–∏: {len(data['asks'])} –∑–∞–ø–∏—Å–µ–π")
            print(f"   –ë–∏–¥—ã: {len(data['bids'])} –∑–∞–ø–∏—Å–µ–π")
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            message = service.format_orderbook_for_telegram(data)
            print("\nüì® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram:")
            print("-" * 50)
            print(message)
            print("-" * 50)
            
            return True
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω")
            return False
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: {e}")
        import traceback
        traceback.print_exc()
        return False

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üöÄ –¢–µ—Å—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞–∫–∞–Ω–∞")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
    from dotenv import load_dotenv
    load_dotenv()
    
    token = os.getenv('INVEST_TOKEN')
    if not token or "–≤–∞—à_—Ç–æ–∫–µ–Ω" in token:
        print("‚ùå –¢–æ–∫–µ–Ω Tinkoff –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!")
        print("   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .env")
        return
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
    success = asyncio.run(test_monitoring())
    
    if success:
        print("\n‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω! –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å")
    else:
        print("\n‚ùå –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Tinkoff API")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: tests/test_orderbook.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_orderbook.py
================================================================================

#!/usr/bin/env python3
"""
–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç —Å—Ç–∞–∫–∞–Ω–∞ - –∑–∞–ø—É—Å–∫–∞—Ç—å –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º src –≤ –ø—É—Ç—å Python
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

from data_feed.orderbook import MOEXOrderbook

def main():
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ç–∞–∫–∞–Ω...")
    
    client = MOEXOrderbook()
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ SBER (–æ–Ω –≤—Å–µ–≥–¥–∞ —Ç–æ—Ä–≥—É–µ—Ç—Å—è)
    print("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞–∫–∞–Ω SBER...")
    client.print_pretty_orderbook("SBER")
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ GAZP
    print("\nüîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞–∫–∞–Ω GAZP...")
    client.print_pretty_orderbook("GAZP")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: tests/test_setup.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_setup.py
================================================================================

print("üéâ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!")
print("–í—ã –≤ –ø–∞–ø–∫–µ:", __file__)

import sys
print("Python –ø—É—Ç—å:", sys.executable)

# –ü—Ä–æ–≤–µ—Ä–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
try:
    import pandas as pd
    print("‚úÖ pandas —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
except ImportError:
    print("‚ùå pandas –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")

try:
    import numpy as np
    print("‚úÖ numpy —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω") 
except ImportError:
    print("‚ùå numpy –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")


================================================================================
–§–ê–ô–õ: tests/test_tinkoff_simple.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_tinkoff_simple.py
================================================================================

#!/usr/bin/env python3
"""
–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç Tinkoff API (–±–æ–µ–≤–æ–π –∫–æ–Ω—Ç—É—Ä)
"""

import os
import sys
from dotenv import load_dotenv

# –î–æ–±–∞–≤–ª—è–µ–º src –≤ –ø—É—Ç—å Python
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

load_dotenv()

def main():
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Tinkoff API...")
    
    token = os.getenv('INVEST_TOKEN')
    if not token:
        print("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
        return
    
    try:
        from tinkoff.invest import Client
        
        with Client(token) as client:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—á–µ—Ç–∞
            accounts = client.users.get_accounts()
            print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!")
            print(f"üìã –ù–∞–π–¥–µ–Ω–æ —Å—á–µ—Ç–æ–≤: {len(accounts.accounts)}")
            
            for account in accounts.accounts:
                print(f"   - {account.name} (ID: {account.id})")
                
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")

if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: tests/test_vscode.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /Users/vladimirbasov/Desktop/python_trading/tests/test_vscode.py
================================================================================

import sys
print("üéØ VSCode —Ç–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω!")
print(f"Python –ø—É—Ç—å: {sys.executable}")
print(f"–í–µ—Ä—Å–∏—è Python: {sys.version}")

if "trading_env" in sys.executable:
    print("‚úÖ –†–∞–±–æ—Ç–∞–µ–º –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏!")
else:
    print("‚ùå –ù–ï –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏!")

import os
print(f"üìÅ –ü—É—Ç—å: {os.getcwd()}")


================================================================================
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –≠–ö–°–ü–û–†–¢–ê
================================================================================
–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: 60
–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –∫–æ–¥–∞: 146239 –±–∞–π—Ç (142.8 –ö–ë)
–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: 2025-12-25 17:54:15
================================================================================

üéØ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:
1. –ò—â–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ —Å—Ç—Ä–æ–∫–µ "–§–ê–ô–õ: "
2. –í—Å–µ –ø—É—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ: /Users/vladimirbasov/Desktop/python_trading
3. –î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
4. .env —Ñ–∞–π–ª—ã –æ—á–∏—â–µ–Ω—ã –æ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤

================================================================================
–ö–û–ù–ï–¶ –≠–ö–°–ü–û–†–¢–ê
================================================================================
