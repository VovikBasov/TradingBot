#!/bin/bash

echo "================================================"
echo "ü§ñ –ó–ê–ü–£–°–ö –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–≠–ö–¢–ï–°–¢–ê"
echo "================================================"
echo "–ü–∞—Ä–∞: TGKJ ‚Üî ALRS"
echo "–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—á–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞"
echo "================================================"
echo ""

# –®–∞–≥ 1: –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
if [ -z "$VIRTUAL_ENV" ]; then
    echo "üîÑ –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
    source ../../trading_env/bin/activate
fi

# –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω—ã
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏..."
if [ ! -f "../../.env" ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "   –°–æ–∑–¥–∞–π—Ç–µ .env —Å —Ç–æ–∫–µ–Ω–∞–º–∏ Tinkoff API"
    exit 1
fi

# –®–∞–≥ 3: –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–∞—Ä—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
echo ""
echo "üì• –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö..."
if [ ! -f "data/TGKJ_historical.csv" ] || [ ! -f "data/ALRS_historical.csv" ]; then
    echo "üì• –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∑–∞–≥—Ä—É–∂–∞–µ–º..."
    python load_pair_data.py TGKJ ALRS
    
    if [ $? -ne 0 ]; then
        echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö"
        exit 1
    fi
else
    echo "‚úÖ –î–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"
fi

# –®–∞–≥ 4: –ó–∞–ø—É—Å–∫–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç
echo ""
echo "üìä –®–ê–ì 2: –ó–∞–ø—É—Å–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∞..."
python pair_arbitrage_backtest_fixed.py

echo ""
echo "================================================"
echo "üéØ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–≠–ö–¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù!"
echo "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø–∞–ø–∫–µ: tests/strategies/results/"
echo "–§–∞–π–ª—ã —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º _FIXED —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã"
echo "================================================"
